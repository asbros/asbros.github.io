<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'/>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'/>
    <title>AS Cineplex - Liquid Glass UI</title>
    <meta content='#0f0f0f' name='theme-color'/>
    <meta content='AS Cineplex - Modern Streaming Platform' name='description'/>
    <link href='https://i.imgur.com/ZEQdTSH.png' rel='shortcut icon' type='image/x-icon'/>
    <link href='https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap' rel='stylesheet'>
    <style>
        :root {--primary: #e50914; --primary-dark: #b2070f; --primary-glow: rgba(229, 9, 20, 0.3); --secondary: #1a1a1a; --background: #0a0a0a; --surface: rgba(255, 255, 255, 0.05); --surface-light: rgba(255, 255, 255, 0.08); --surface-dark: rgba(0, 0, 0, 0.3); --text-primary: #ffffff; --text-secondary: rgba(255, 255, 255, 0.7); --text-muted: rgba(255, 255, 255, 0.5); --border: rgba(255, 255, 255, 0.1); --gradient: linear-gradient(135deg, #e50914 0%, #b2070f 100%); --glass: rgba(255, 255, 255, 0.1); --glass-border: rgba(255, 255, 255, 0.2); --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); --blur: blur(20px); --radius: 16px; --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);}
        * {margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif;}
        body {background: var(--background); color: var(--text-primary); line-height: 1.6; overflow-x: hidden; background-image: radial-gradient(circle at 20% 80%, rgba(229, 9, 20, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(229, 9, 20, 0.1) 0%, transparent 50%); min-height: 100vh;}
        .header {background: rgba(10, 10, 10, 0.8); backdrop-filter: var(--blur); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000; padding: 1rem 2rem;}
        .header-content {display: flex; align-items: center; justify-content: space-between; max-width: 1400px; margin: 0 auto;}
        .logo {display: flex; align-items: center; gap: 0.75rem; text-decoration: none;}
        .logo-icon {width: 40px; height: 40px; background: var(--gradient); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.25rem; box-shadow: 0 4px 20px var(--primary-glow);}
        .logo-text {font-size: 1.5rem; font-weight: 700; background: linear-gradient(135deg, #fff 0%, #ccc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);}
        .search-container {display: flex; align-items: center; gap: 1rem; flex: 1; max-width: 600px; margin: 0 2rem;}
        .type-selector {background: var(--surface); border: 1px solid var(--glass-border); border-radius: var(--radius); color: var(--text-primary); padding: 0.75rem 1rem; font-size: 0.9rem; cursor: pointer; transition: var(--transition); min-width: 120px; backdrop-filter: var(--blur);}
        .type-selector:focus {outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px var(--primary-glow);}
        .search-input {flex: 1; background: var(--surface); border: 1px solid var(--glass-border); border-radius: var(--radius); color: var(--text-primary); padding: 0.75rem 1.5rem; font-size: 0.95rem; transition: var(--transition); backdrop-filter: var(--blur);}
        .search-input:focus {outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px var(--primary-glow);}
        .header-actions {display: flex; align-items: center; gap: 1rem;}
        .icon-button {background: var(--surface); border: 1px solid var(--glass-border); border-radius: var(--radius); color: var(--text-primary); padding: 0.75rem; cursor: pointer; transition: var(--transition); display: flex; align-items: center; justify-content: center; backdrop-filter: var(--blur);}
        .icon-button:hover {background: var(--surface-light); border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 20px var(--primary-glow);}
        .main-container {max-width: 1400px; margin: 0 auto; padding: 0 2rem;}
        .player-section {background: var(--surface); border-radius: var(--radius); padding: 2rem; margin-bottom: 2rem; box-shadow: var(--glass-shadow); backdrop-filter: var(--blur); border: 1px solid var(--glass-border);}
        .player-header {display: flex; justify-content: between; align-items: center; margin-bottom: 1.5rem;}
        .back-button {background: var(--surface-light); border: 1px solid var(--glass-border); border-radius: var(--radius); color: var(--text-primary); padding: 0.75rem 1.5rem; cursor: pointer; transition: var(--transition); display: flex; align-items: center; gap: 0.5rem; font-weight: 500; backdrop-filter: var(--blur);}
        .back-button:hover {background: var(--primary); border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 20px var(--primary-glow);}
        .player-layout {display: grid; grid-template-columns: 60% 40%; gap: 2rem; margin-bottom: 2rem;}
        .player-left {display: flex; flex-direction: column; gap: 1.5rem;}
        .player-right {display: flex; flex-direction: column; gap: 1.5rem;margin-right: 2rem;}
        .video-container {position: relative; width: 100%; border-radius: var(--radius); overflow: hidden; background: #000; box-shadow: var(--glass-shadow);}
        #video {width: 100%; aspect-ratio: 16/9; border: none; background: #000;}
        .servers-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.75rem;}
        .server-button {background: var(--surface-light); border: 1px solid var(--glass-border); border-radius: var(--radius); color: var(--text-primary); padding: 0.75rem 0.5rem; cursor: pointer; transition: var(--transition); text-align: center; font-weight: 500; font-size: 0.85rem; backdrop-filter: var(--blur);}
        .server-button:hover, .server-button.active {background: var(--primary); border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 15px var(--primary-glow);}
        .content-details {background: var(--surface-light); border-radius: var(--radius); padding: 1.5rem; backdrop-filter: var(--blur); border: 1px solid var(--glass-border);}
        .content-title {font-size: 1.75rem; font-weight: 700; margin-bottom: 1rem; background: linear-gradient(135deg, #fff 0%, #ccc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        .content-meta {display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; color: var(--text-secondary); font-size: 0.9rem;}
        .meta-item {display: flex; align-items: center; gap: 0.5rem; background: var(--surface-dark); padding: 0.5rem 0.75rem; border-radius: 20px; backdrop-filter: var(--blur);}
        .rating {color: #ffd700; font-weight: 600;}
        .content-overview {color: var(--text-secondary); line-height: 1.7; margin-bottom: 1.5rem;}
        .genres {display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1.5rem;}
        .genre-tag {background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 500; backdrop-filter: var(--blur);}
        .cast-section {margin-top: 1rem;}
        .cast-title {font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;}
        .cast-scroll {display: flex; gap: 1rem; overflow-x: auto; padding-bottom: 1rem;}
        .cast-scroll::-webkit-scrollbar {height: 6px;}
        .cast-scroll::-webkit-scrollbar-track {background: var(--surface); border-radius: 3px;}
        .cast-scroll::-webkit-scrollbar-thumb {background: var(--primary); border-radius: 3px;}
        .cast-member {flex: 0 0 auto; width: 100px; text-align: center;}
        .cast-photo {width: 100%; aspect-ratio: 2/3; border-radius: var(--radius); object-fit: cover; margin-bottom: 0.5rem; background: var(--surface); box-shadow: var(--glass-shadow);}
        .cast-name {font-weight: 600; font-size: 0.8rem; margin-bottom: 0.25rem; line-height: 1.2;}
        .cast-character {color: var(--text-muted); font-size: 0.75rem; line-height: 1.2;}
        .content-grid {display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;}
        .content-card {background: var(--surface); border-radius: var(--radius); overflow: hidden; transition: var(--transition); cursor: pointer; box-shadow: var(--glass-shadow); backdrop-filter: var(--blur); border: 1px solid var(--glass-border); position: relative;}
        .content-card:hover {transform: translateY(-8px) scale(1.02); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 0 1px var(--primary-glow);}
        .content-poster {width: 100%; aspect-ratio: 2/3; object-fit: cover; background: var(--surface-light);}
        .content-info {padding: 1rem; background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%); position: absolute; bottom: 0; left: 0; right: 0;}
        .content-name {font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; line-height: 1.3; color: white;}
        .content-meta-small {display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; color: var(--text-secondary);}
        .content-year {color: var(--text-secondary);}
        .content-rating {display: flex; align-items: center; gap: 0.25rem; color: #ffd700; font-weight: 600;}
        .load-more {background: var(--gradient); border: none; border-radius: var(--radius); color: white; padding: 1rem 2rem; font-weight: 600; cursor: pointer; transition: var(--transition); display: block; margin: 2rem auto; min-width: 200px; backdrop-filter: var(--blur); box-shadow: 0 8px 25px var(--primary-glow);}
        .load-more:hover {transform: translateY(-2px); box-shadow: 0 12px 35px var(--primary-glow);}
        .install-prompt {background: var(--surface); border: 1px solid var(--glass-border); border-radius: var(--radius); padding: 1rem 1.5rem; position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); z-index: 1001; display: flex; align-items: center; gap: 1rem; transition: var(--transition); box-shadow: var(--glass-shadow); max-width: 400px; width: 90%; backdrop-filter: var(--blur);}
        .install-prompt.show {bottom: 2rem;}
        .install-text {flex: 1; font-size: 0.9rem;}
        .install-button {background: var(--primary); border: none; border-radius: var(--radius); color: white; padding: 0.5rem 1rem; font-weight: 500; cursor: pointer; transition: var(--transition);}
        .install-button:hover {background: var(--primary-dark);}
        .close-button {background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 0.25rem; transition: var(--transition);}
        .close-button:hover {color: var(--text-primary);}
        .footer {background: var(--surface); border-top: 1px solid var(--border); padding: 2rem; text-align: center; margin-top: 4rem; backdrop-filter: var(--blur);}
        .footer-content {max-width: 1200px; margin: 0 auto;}
        .footer-links {display: flex; justify-content: center; gap: 2rem; margin-bottom: 1rem; flex-wrap: wrap;}
        .footer-link {color: var(--text-secondary); text-decoration: none; transition: var(--transition);}
        .footer-link:hover {color: var(--primary);}
        .footer-copyright {color: var(--text-muted); font-size: 0.9rem;}
        .history-header {text-align: center; margin-bottom: 2rem;}
        .history-title {font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;}
        .history-subtitle {color: var(--text-secondary); margin-bottom: 2rem;}
        .clear-history {background: var(--surface-light); border: 1px solid var(--glass-border); border-radius: var(--radius); color: var(--text-primary); padding: 0.75rem 1.5rem; cursor: pointer; transition: var(--transition); display: flex; align-items: center; gap: 0.5rem; margin: 0 auto 2rem; backdrop-filter: var(--blur);}
        .clear-history:hover {background: var(--primary); border-color: var(--primary); box-shadow: 0 4px 20px var(--primary-glow);}
        .section-header {display: flex; justify-content: space-between; align-items: center; margin-top: 2rem;}
        .section-title {font-size: 1.5rem; font-weight: 700; background: linear-gradient(135deg, #fff 0%, #ccc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        .section-scroll {display: flex; gap: 1rem; overflow-x: auto; padding: 1rem 0; margin: 0 -0.5rem;}
        .section-scroll::-webkit-scrollbar {height: 6px;}
        .section-scroll::-webkit-scrollbar-track {background: var(--surface); border-radius: 3px;}
        .section-scroll::-webkit-scrollbar-thumb {background: var(--primary); border-radius: 3px;}
        .section-card {flex: 0 0 auto; width: 150px; background: var(--surface); border-radius: var(--radius); overflow: hidden; transition: var(--transition); cursor: pointer; box-shadow: var(--glass-shadow); backdrop-filter: var(--blur); border: 1px solid var(--glass-border);}
        .section-card:hover {transform: translateY(-4px) scale(1.02); box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4), 0 0 0 1px var(--primary-glow);}
        .section-poster {width: 100%; aspect-ratio: 3/4; object-fit: cover; background: var(--surface-light);}
        .section-info {padding: 0.5rem;}
        .section-name {font-weight: 600; margin-bottom: 0.25rem; font-size: 0.85rem; line-height: 1.3;}
        .section-meta {display: flex; justify-content: space-between; align-items: center; font-size: 0.7rem; color: var(--text-secondary);}
        .search-page {background: var(--surface); border-radius: var(--radius); padding: 2rem; margin-bottom: 2rem; box-shadow: var(--glass-shadow); backdrop-filter: var(--blur); border: 1px solid var(--glass-border);}
        .search-header {text-align: center; margin-bottom: 2rem;}
        .search-title {font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; background: linear-gradient(135deg, #fff 0%, #ccc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        .search-subtitle {color: var(--text-secondary); margin-bottom: 2rem;}
        .search-results-info {margin-bottom: 1.5rem; color: var(--text-secondary); font-size: 0.9rem;}
        
        /* Shimmer Effects */
        .shimmer {position: relative; overflow: hidden; background: var(--surface-light);}
        .shimmer::before {content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); animation: shimmer 1.5s infinite;}
        @keyframes shimmer {0% {left: -100%;} 100% {left: 100%;}}
        
        .shimmer-card {background: var(--surface-light); border-radius: var(--radius); overflow: hidden; position: relative;}
        .shimmer-poster {width: 100%; aspect-ratio: 2/3; background: var(--surface);}
        .shimmer-info {padding: 1rem;}
        .shimmer-line {height: 12px; background: var(--surface); border-radius: 4px; margin-bottom: 8px;}
        .shimmer-line.short {width: 60%;}
        .shimmer-line.very-short {width: 40%; height: 10px;}
        
        .shimmer-section-card {width: 180px; background: var(--surface-light); border-radius: var(--radius); overflow: hidden;}
        .shimmer-section-poster {width: 100%; aspect-ratio: 3/4; background: var(--surface);}
        .shimmer-section-info {padding: 0.75rem;}
        .shimmer-section-line {height: 10px; background: var(--surface); border-radius: 4px; margin-bottom: 6px;}
        .shimmer-section-line.short {width: 50%;}
        .shimmer-section-line.very-short {width: 30%; height: 8px;}
        
        /* Loading states */
        .loading {opacity: 0.7; pointer-events: none;}
        
        /* ===== RESPONSIVE IMPROVEMENTS ===== */
        @media (max-width: 1024px) {
            .player-layout {grid-template-columns: 1fr;}
            .player-right {margin-right: 0;}
            .content-grid {grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 1rem;}
            .section-card, .shimmer-section-card {width: 150px;}
        }
        
        @media (max-width: 768px) {
            .header {padding: 0.75rem 1rem;}
            .header-content {flex-direction: column; gap: 1rem; padding: 0;}
            .search-container {margin: 0; width: 100%; order: 3;}
            .main-container {padding: 1rem;}
            
            /* Smaller content cards */
            .content-grid {grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 0.75rem;}
            .content-info {padding: 0.5rem;}
            .content-name {font-size: 0.75rem; margin-bottom: 0.25rem;}
            .content-meta-small {font-size: 0.65rem;}
            
            /* Smaller section cards */
            .section-card, .shimmer-section-card {width: 140px;}
            .section-info {padding: 0.5rem;}
            .section-name {font-size: 0.75rem;}
            .section-meta {font-size: 0.6rem;}
            
            /* Player section improvements */
            .player-section {padding: 1rem;}
            .player-layout {gap: 1rem;}
            .content-details {padding: 1rem;}
            .content-title {font-size: 1.5rem;}
            .content-overview {font-size: 0.9rem;}
            .servers-grid {grid-template-columns: repeat(2, 1fr);}
            
            /* Cast section */
            .cast-member {width: 80px;}
            .cast-name {font-size: 0.7rem;}
            .cast-character {font-size: 0.65rem;}
            
            /* Header actions */
            .header-actions {width: 100%; justify-content: center;}
            .logo-text {font-size: 1.25rem;}
            .logo-icon {width: 35px; height: 35px; font-size: 1rem;}
        }
        
        @media (max-width: 480px) {
            .header {padding: 0.5rem 0.75rem;}
            .header-content{flex-wrap: wrap;}
            .logo, .header-actions{flex: 1;}
            .header-content {flex-direction: row;}
            .main-container {padding: 0.75rem;}
            
            /* Even smaller cards for mobile */
            .content-grid {grid-template-columns: repeat(auto-fill, minmax(95px, 1fr)); gap: 0.5rem;}
            .content-info {padding: 0.4rem;}
            .content-name {font-size: 0.7rem; line-height: 1.1;}
            .content-meta-small {flex-direction: column; gap: 0.1rem; align-items: flex-start;}
            
            /* Section cards */
            .section-card, .shimmer-section-card {width: 140px;}
            .section-info {padding: 0.4rem;}
            .section-name {font-size: 0.7rem;}
            
            /* Player section */
            .player-section {padding: 0.75rem; margin-bottom: 1rem;}
            .player-layout {display: block;}
            .player-left{margin-bottom: 20px;}
            .content-title {font-size: 1.25rem;}
            .content-meta {gap: 0.5rem;}
            .meta-item {padding: 0.4rem 0.6rem; font-size: 0.8rem;}
            .genres {gap: 0.25rem;}
            .genre-tag {font-size: 0.7rem; padding: 0.2rem 0.5rem;}
            
            /* Search page */
            .search-page {padding: 1rem;}
            .search-title {font-size: 1.5rem;}
            
            /* Footer */
            .footer {padding: 1.5rem 1rem;}
            .footer-links {gap: 1rem;}
        }
        
        /*@media (max-width: 360px) {
            .player-layout {display: block;}
            .content-grid {grid-template-columns: repeat(auto-fill, minmax(85px, 1fr));}
            .section-card, .shimmer-section-card {width: 90px;}
            .section-name {font-size: 0.65rem;}
        }*/
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="?page=home" class="logo">
                <div class="logo-icon">AS</div>
                <div class="logo-text">CINEPLEX</div>
            </a>
            <div class="search-container">
                <select id="stype" class="type-selector">
                    <option value="movie">Movies</option>
                    <option value="tv">TV Series</option>
                </select>
                <input type="search" id="search" class="search-input" placeholder="Search movies, TV series..." />
            </div>
            <div class="header-actions">
                <button class="icon-button" id="historyBtn" title="Watch History">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </button>
                <button class="icon-button" id="searchPageBtn" title="Search Page">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                </button>
                <button class="icon-button" id="shareBtn" title="Share">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8m-4-6l-4-4-4 4m4-4v13"/></svg>
                </button>
            </div>
        </div>
    </header>

    <main class="main-container">
        <!-- Player Section -->
        <section id="playerSection" class="player-section" style="display: none;">
            <div class="player-header">
                <button class="back-button" id="backBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5m0 0l7 7m-7-7l7-7"/></svg>Back
                </button>
            </div>
            <div class="player-layout">
                <div class="player-left">
                    <div class="video-container">
                        <iframe id="video" allowfullscreen></iframe>
                    </div>
                    <div class="servers-grid" id="servers"></div>
                </div>
                <div class="player-right">
                    <div class="content-details">
                        <h1 id="contentTitle" class="content-title"></h1>
                        <div class="content-meta" id="contentMeta"></div>
                        <div class="genres" id="genresContainer"></div>
                        <p id="contentOverview" class="content-overview"></p>
                        <div class="cast-section">
                            <h3 class="cast-title">Cast</h3>
                            <div class="cast-scroll" id="castContainer"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Home Section -->
        <section id="homeSection">
            <div class="section-header">
                <h2 class="section-title">Now Playing</h2>
            </div>
            <div class="section-scroll" id="nowPlayingSection">
                <!-- Shimmer loading for now playing section -->
                <div class="shimmer-section-card shimmer">
                    <div class="shimmer-section-poster"></div>
                    <div class="shimmer-section-info">
                        <div class="shimmer-section-line"></div>
                        <div class="shimmer-section-line short"></div>
                        <div class="shimmer-section-line very-short"></div>
                    </div>
                </div>
                <!-- More shimmer cards will be added by JavaScript -->
            </div>

            <!-- Genre sections will be dynamically created here -->
            <div id="genreSectionsContainer"></div>
        </section>

        <!-- Search Page Section -->
        <section id="searchPageSection" class="search-page" style="display: none;">
            <div class="search-header">
                <h1 class="search-title">Search Results</h1>
                <p class="search-subtitle">Find your favorite movies and TV shows</p>
            </div>
            <div class="search-results-info" id="searchResultsInfo"></div>
            <div id="searchResultsGrid" class="content-grid">
                <!-- Shimmer loading for search results -->
                <div class="shimmer-card shimmer">
                    <div class="shimmer-poster"></div>
                    <div class="shimmer-info">
                        <div class="shimmer-line"></div>
                        <div class="shimmer-line short"></div>
                        <div class="shimmer-line very-short"></div>
                    </div>
                </div>
                <!-- More shimmer cards will be added by JavaScript -->
            </div>
            <button id="loadMoreSearch" class="load-more" style="display: none;">Load More Results</button>
        </section>

        <!-- Content Grid Section -->
        <section id="contentSection" style="display: none;">
            <div id="contentGrid" class="content-grid">
                <!-- Shimmer loading for content grid -->
                <div class="shimmer-card shimmer">
                    <div class="shimmer-poster"></div>
                    <div class="shimmer-info">
                        <div class="shimmer-line"></div>
                        <div class="shimmer-line short"></div>
                        <div class="shimmer-line very-short"></div>
                    </div>
                </div>
                <!-- More shimmer cards will be added by JavaScript -->
            </div>
            <button id="loadMore" class="load-more">Load More</button>
        </section>

        <!-- History Section -->
        <section id="historySection" style="display: none;">
            <div class="history-header">
                <h1 class="history-title">Watch History</h1>
                <p class="history-subtitle">Your recently watched content</p>
            </div>
            <button class="clear-history" id="clearHistoryBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>Clear History
            </button>
            <div id="historyGrid" class="content-grid"></div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="?page=home" class="footer-link">Home</a>
                <a href="?page=search" class="footer-link">Search</a>
                <a href="#" class="footer-link">About</a>
                <a href="#" class="footer-link">Privacy</a>
                <a href="#" class="footer-link">Terms</a>
            </div>
            <div class="footer-copyright">¬© 2024 AS Cineplex. Powered by TMDB.</div>
        </div>
    </footer>

    <div id="installPrompt" class="install-prompt">
        <div class="install-text">Install AS Cineplex for better experience</div>
        <button class="install-button" id="installBtn">Install</button>
        <button class="close-button" id="closeInstallBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </button>
    </div>

    <script>
        // Global variables
        let currentPage = 1;
        let currentType = 'movie';
        let currentContent = [];
        let isSearching = false;
        let searchQuery = '';
        let installPromptEvent = null;
        let totalPages = 1;
        let searchCurrentPage = 1;

        // Genre array with TMDB genre IDs
        const genres = [
            { name: "Action", id: 28 },
            { name: "Adventure", id: 12 },
            { name: "Mystery", id: 9648 },
            { name: "Romance", id: 10749 },
            { name: "Science Fiction", id: 878 },
            { name: "Thriller", id: 53 },
            { name: "Horror", id: 27 },
            { name: "Comedy", id: 35 },
            { name: "Crime", id: 80 },
            { name: "Drama", id: 18 },
            { name: "Fantasy", id: 14 },
            { name: "Animation", id: 16 },
            { name: "History", id: 36 },
            { name: "War", id: 10752 }
        ];

        // DOM Elements
        const playerSection = document.getElementById('playerSection');
        const homeSection = document.getElementById('homeSection');
        const searchPageSection = document.getElementById('searchPageSection');
        const contentSection = document.getElementById('contentSection');
        const historySection = document.getElementById('historySection');
        const contentGrid = document.getElementById('contentGrid');
        const historyGrid = document.getElementById('historyGrid');
        const searchResultsGrid = document.getElementById('searchResultsGrid');
        const searchResultsInfo = document.getElementById('searchResultsInfo');
        const video = document.getElementById('video');
        const serversContainer = document.getElementById('servers');
        const castContainer = document.getElementById('castContainer');
        const contentTitle = document.getElementById('contentTitle');
        const contentOverview = document.getElementById('contentOverview');
        const contentMeta = document.getElementById('contentMeta');
        const genresContainer = document.getElementById('genresContainer');
        const loadMoreBtn = document.getElementById('loadMore');
        const loadMoreSearchBtn = document.getElementById('loadMoreSearch');
        const searchInput = document.getElementById('search');
        const typeSelector = document.getElementById('stype');
        const backBtn = document.getElementById('backBtn');
        const historyBtn = document.getElementById('historyBtn');
        const searchPageBtn = document.getElementById('searchPageBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const shareBtn = document.getElementById('shareBtn');
        const installPrompt = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');
        const closeInstallBtn = document.getElementById('closeInstallBtn');

        // Section containers
        const nowPlayingSection = document.getElementById('nowPlayingSection');
        const genreSectionsContainer = document.getElementById('genreSectionsContainer');

        // TMDB API Configuration
        const options = {
            method: 'GET',
            headers: {
                accept: 'application/json',
                Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI1ZjdlM2FiNDQ5MjQ1ZDZmNzFhMWY4ZDRkOGJmM2UxNiIsIm5iZiI6MTczMDEzNzc2My4zNTU5NDEsInN1YiI6IjY3MWZjZGM5NWJlOWU4NzU5ZGE3Y2FmYSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.fonkbuJWUqjyjvX-n0btWTLvacdPNYcaD5s_sunLLqg'
            }
        };

        // URL Parameter Management
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const page = params.get('page');
            const id = params.get('id');
            const query = params.get('query');
            return { page, id, query };
        }

        function updateUrl(page, id = null, query = null) {
            const url = new URL(window.location);
            url.searchParams.set('page', page);
            if (id) {
                url.searchParams.set('id', id);
            } else {
                url.searchParams.delete('id');
            }
            if (query) {
                url.searchParams.set('query', query);
            } else {
                url.searchParams.delete('query');
            }
            window.history.pushState({}, '', url);
            handlePageChange();
        }

        function handlePageChange() {
            const params = getUrlParams();
            hideAllSections();
            
            switch(params.page) {
                case 'tv':
                case 'movie':
                    if (params.id) {
                        showPlayerPage(params.page, params.id);
                    } else {
                        showHomePage();
                    }
                    break;
                case 'history':
                    showHistoryPage();
                    break;
                case 'search':
                    showSearchPage(params.query);
                    break;
                default:
                    showHomePage();
            }
        }

        // Initialize App
        function initApp() {
            handlePageChange();
            setupEventListeners();
            checkInstallPrompt();
            loadRecentsStatus();
            loadHomeSections();
        }

        function setupEventListeners() {
            searchInput.addEventListener('input', debounce(handleSearch, 300));
            typeSelector.addEventListener('change', () => {
                currentType = typeSelector.value;
                if (searchInput.value) handleSearch();
            });
            
            // Fixed back button behavior - always goes back in webpage history
            backBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                goBack();
            });
            
            historyBtn.addEventListener('click', () => updateUrl('history'));
            searchPageBtn.addEventListener('click', () => updateUrl('search'));
            clearHistoryBtn.addEventListener('click', clearHistory);
            shareBtn.addEventListener('click', shareContent);
            loadMoreBtn.addEventListener('click', loadMoreContent);
            loadMoreSearchBtn.addEventListener('click', loadMoreSearchResults);
            installBtn.addEventListener('click', installApp);
            closeInstallBtn.addEventListener('click', hideInstallPrompt);
            window.addEventListener('popstate', handlePageChange);
        }

        // Page Management
        function showHomePage() {
            homeSection.style.display = 'block';
            loadMoreBtn.style.display = 'block';
            currentPage = 1;
            currentContent = [];
        }

        function showPlayerPage(type, id) {
            playerSection.style.display = 'block';
            loadContentDetails(type, id);
        }

        function showHistoryPage() {
            historySection.style.display = 'block';
            loadHistoryContent();
        }

        function showSearchPage(query = '') {
            searchPageSection.style.display = 'block';
            if (query) {
                searchInput.value = query;
                handleSearchPage(query);
            }
        }

        function hideAllSections() {
            playerSection.style.display = 'none';
            homeSection.style.display = 'none';
            searchPageSection.style.display = 'none';
            contentSection.style.display = 'none';
            historySection.style.display = 'none';
        }

        // Home Page Sections
        async function loadHomeSections() {
            // Add shimmer loading for now playing section
            addShimmerCards(nowPlayingSection, 'section', 8);
            
            try {
                // Now Playing
                const nowPlayingResponse = await fetch('https://api.themoviedb.org/3/discover/movie?page=1&certification_country=IN&sort_by=popularity.desc&watch_region=IN&with_original_language=hi', options);
                const nowPlayingData = await nowPlayingResponse.json();
                renderSection(nowPlayingSection, nowPlayingData.results, 'movie');
                
                // Load genre sections dynamically
                await loadGenreSections();
                
            } catch (error) {
                console.error('Error loading home sections:', error);
                // Remove shimmer on error
                nowPlayingSection.innerHTML = '<div style="padding: 2rem; color: var(--text-secondary); text-align: center;">Failed to load content</div>';
            }
        }

        // Add shimmer loading cards
        function addShimmerCards(container, type, count) {
            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const shimmerCard = document.createElement('div');
                if (type === 'section') {
                    shimmerCard.className = 'shimmer-section-card shimmer';
                    shimmerCard.innerHTML = `
                        <div class="shimmer-section-poster"></div>
                        <div class="shimmer-section-info">
                            <div class="shimmer-section-line"></div>
                            <div class="shimmer-section-line short"></div>
                            <div class="shimmer-section-line very-short"></div>
                        </div>
                    `;
                } else {
                    shimmerCard.className = 'shimmer-card shimmer';
                    shimmerCard.innerHTML = `
                        <div class="shimmer-poster"></div>
                        <div class="shimmer-info">
                            <div class="shimmer-line"></div>
                            <div class="shimmer-line short"></div>
                            <div class="shimmer-line very-short"></div>
                        </div>
                    `;
                }
                container.appendChild(shimmerCard);
            }
        }

        // Load genre sections dynamically
        async function loadGenreSections() {
            for (const genre of genres) {
                try {
                    // Create section with shimmer first
                    const sectionId = createGenreSectionWithShimmer(genre.name);
                    
                    // Fetch data
                    const response = await fetch(`https://api.themoviedb.org/3/discover/movie?with_genres=${genre.id}&with_original_language=hi&sort_by=popularity.desc&page=1`, options);
                    const data = await response.json();
                    
                    // Update section with actual content
                    updateGenreSection(sectionId, data.results, 'movie');
                    
                    // Small delay to avoid overwhelming the API
                    await new Promise(resolve => setTimeout(resolve, 100));
                } catch (error) {
                    console.error(`Error loading ${genre.name} movies:`, error);
                }
            }
        }

        // Create genre section with shimmer loading
        function createGenreSectionWithShimmer(genreName) {
            const sectionId = `${genreName.toLowerCase().replace(/\s+/g, '')}Section`;
            
            // Create section header
            const sectionHeader = document.createElement('div');
            sectionHeader.className = 'section-header';
            sectionHeader.innerHTML = `<h2 class="section-title">${genreName}</h2>`;
            
            // Create scroll container with shimmer
            const scrollContainer = document.createElement('div');
            scrollContainer.className = 'section-scroll';
            scrollContainer.id = sectionId;
            
            // Add shimmer cards
            addShimmerCards(scrollContainer, 'section', 8);
            
            // Append to genre sections container
            genreSectionsContainer.appendChild(sectionHeader);
            genreSectionsContainer.appendChild(scrollContainer);
            
            return sectionId;
        }

        // Update genre section with actual content
        function updateGenreSection(sectionId, content, type) {
            const sectionElement = document.getElementById(sectionId);
            if (!sectionElement) return;
            
            renderSection(sectionElement, content, type);
        }

        function renderSection(sectionElement, content, type) {
            sectionElement.innerHTML = '';
            
            if (!content || content.length === 0) {
                sectionElement.innerHTML = '<div style="padding: 2rem; color: var(--text-secondary); text-align: center;">No content available</div>';
                return;
            }
            
            content.forEach(item => {
                const card = document.createElement('div');
                card.className = 'section-card';
                card.onclick = () => updateUrl(type, item.id);
                
                const posterUrl = item.poster_path 
                    ? `https://image.tmdb.org/t/p/w300${item.poster_path}`
                    : 'https://i.imgur.com/eG5fXDo.png';
                
                const releaseDate = item.release_date || item.first_air_date;
                const year = releaseDate ? new Date(releaseDate).getFullYear() : '';
                const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
                
                card.innerHTML = `
                    <img src="${posterUrl}" alt="${item.title || item.name}" class="section-poster" loading="lazy" />
                    <div class="section-info">
                        <div class="section-name">${item.title || item.name}</div>
                        <div class="section-meta">
                            <div class="content-year">${year}</div>
                            <div class="content-rating">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="#ffd700">
                                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                                </svg>
                                ${rating}
                            </div>
                        </div>
                    </div>
                `;
                sectionElement.appendChild(card);
            });
        }

        // Search Functionality
        async function handleSearch() {
            const query = searchInput.value.trim();
            searchQuery = query;
            
            if (!query) {
                isSearching = false;
                return;
            }

            // Update URL to search page
            updateUrl('search', null, query);
        }

        async function handleSearchPage(query) {
            searchCurrentPage = 1;
            searchQuery = query;
            
            // Add shimmer loading for search results
            addShimmerCards(searchResultsGrid, 'grid', 12);
            
            try {
                const response = await fetch(`https://api.themoviedb.org/3/search/multi?query=${encodeURIComponent(query)}&include_adult=false&language=en-US&page=${searchCurrentPage}`, options);
                const data = await response.json();
                totalPages = data.total_pages;
                
                searchResultsInfo.textContent = `Found ${data.total_results} results for "${query}"`;
                
                if (data.results && data.results.length > 0) {
                    renderSearchResults(data.results);
                    loadMoreSearchBtn.style.display = searchCurrentPage < totalPages ? 'block' : 'none';
                } else {
                    searchResultsGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-secondary)">No results found</div>';
                    loadMoreSearchBtn.style.display = 'none';
                }
            } catch (error) {
                console.error('Error searching:', error);
                searchResultsGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-secondary)">Failed to load search results</div>';
            }
        }

        async function loadMoreSearchResults() {
            searchCurrentPage++;
            
            try {
                const response = await fetch(`https://api.themoviedb.org/3/search/multi?query=${encodeURIComponent(searchQuery)}&include_adult=false&language=en-US&page=${searchCurrentPage}`, options);
                const data = await response.json();
                
                const currentResults = Array.from(searchResultsGrid.children).map(child => child.getAttribute('data-id'));
                const newResults = data.results.filter(item => !currentResults.includes(item.id.toString()));
                
                renderSearchResults(newResults, false);
                loadMoreSearchBtn.style.display = searchCurrentPage < totalPages ? 'block' : 'none';
            } catch (error) {
                console.error('Error loading more search results:', error);
            }
        }

        function renderSearchResults(results, clear = true) {
            if (clear) {
                searchResultsGrid.innerHTML = '';
            }
            
            if (results.length === 0) {
                return;
            }
            
            results.forEach(item => {
                // Skip items without poster and people
                if (!item.poster_path || item.media_type === 'person') return;
                
                const card = document.createElement('div');
                card.className = 'content-card';
                card.setAttribute('data-id', item.id);
                
                const itemType = item.media_type === 'tv' ? 'tv' : 'movie';
                card.onclick = () => updateUrl(itemType, item.id);
                
                const posterUrl = item.poster_path 
                    ? `https://image.tmdb.org/t/p/w300${item.poster_path}`
                    : 'https://i.imgur.com/eG5fXDo.png';
                
                const releaseDate = item.release_date || item.first_air_date;
                const year = releaseDate ? new Date(releaseDate).getFullYear() : '';
                const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
                
                card.innerHTML = `
                    <img src="${posterUrl}" alt="${item.title || item.name}" class="content-poster" loading="lazy" />
                    <div class="content-info">
                        <div class="content-name">${item.title || item.name}</div>
                        <div class="content-meta-small">
                            <div class="content-year">${year}</div>
                            <div class="content-rating">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="#ffd700">
                                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                                </svg>
                                ${rating}
                            </div>
                        </div>
                    </div>
                `;
                searchResultsGrid.appendChild(card);
            });
        }

        // Content Loading (for backward compatibility)
        async function loadPopularContent() {
            // Add shimmer loading
            addShimmerCards(contentGrid, 'grid', 12);
            
            try {
                const response = await fetch(`https://api.themoviedb.org/3/discover/movie?include_adult=false&include_video=false&language=en-US&sort_by=popularity.desc&page=${currentPage}`, options);
                const data = await response.json();
                totalPages = data.total_pages;
                
                if (currentPage === 1) {
                    currentContent = data.results;
                } else {
                    currentContent = [...currentContent, ...data.results];
                }
                
                renderContentGrid(currentContent);
                updateLoadMoreButton();
            } catch (error) {
                console.error('Error loading content:', error);
                contentGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-secondary)">Failed to load content</div>';
            }
        }

        async function loadMoreContent() {
            currentPage++;
            await loadPopularContent();
        }

        function updateLoadMoreButton() {
            loadMoreBtn.style.display = currentPage < totalPages ? 'block' : 'none';
        }

        // Content Details and Player (keep existing functionality)
        async function loadContentDetails(type, id) {
            try {
                const contentResponse = await fetch(`https://api.themoviedb.org/3/${type}/${id}`, options);
                const contentData = await contentResponse.json();
                const creditsResponse = await fetch(`https://api.themoviedb.org/3/${type}/${id}/credits`, options);
                const creditsData = await creditsResponse.json();
                renderContentDetails(contentData, creditsData.cast, type);
                setupVideoPlayer(type, id, contentData.imdb_id);
                addToHistory(contentData, type);
            } catch (error) {
                console.error('Error loading content details:', error);
            }
        }

        function renderContentDetails(content, cast, type) {
            contentTitle.textContent = content.title || content.name;
            contentOverview.textContent = content.overview || 'No overview available.';
            
            // Render metadata
            contentMeta.innerHTML = '';
            const releaseDate = content.release_date || content.first_air_date;
            const year = releaseDate ? new Date(releaseDate).getFullYear() : 'N/A';
            const runtime = content.runtime || content.episode_run_time?.[0] || 'N/A';
            const voteAverage = content.vote_average ? content.vote_average.toFixed(1) : 'N/A';
            
            const metaItems = [
                { icon: '‚≠ê', text: `<span class="rating">${voteAverage}</span>` },
                { icon: 'üìÖ', text: year },
                { icon: '‚è±Ô∏è', text: type === 'movie' ? `${runtime} min` : `${content.number_of_seasons || 'N/A'} seasons` }
            ];
            
            metaItems.forEach(item => {
                const metaElement = document.createElement('div');
                metaElement.className = 'meta-item';
                metaElement.innerHTML = `${item.icon} ${item.text}`;
                contentMeta.appendChild(metaElement);
            });
            
            // Render genres
            genresContainer.innerHTML = '';
            if (content.genres && content.genres.length > 0) {
                content.genres.forEach(genre => {
                    const genreElement = document.createElement('span');
                    genreElement.className = 'genre-tag';
                    genreElement.textContent = genre.name;
                    genresContainer.appendChild(genreElement);
                });
            }
            
            // Render cast
            castContainer.innerHTML = '';
            const featuredCast = cast.slice(0, 10);
            featuredCast.forEach(person => {
                const castElement = document.createElement('div');
                castElement.className = 'cast-member';
                castElement.innerHTML = `
                    <img src="${person.profile_path ? `https://image.tmdb.org/t/p/w200${person.profile_path}` : 'https://i.imgur.com/EuQ89RI.jpeg'}" 
                         alt="${person.name}" class="cast-photo" loading="lazy" />
                    <div class="cast-name">${person.name}</div>
                    <div class="cast-character">${person.character}</div>
                `;
                castContainer.appendChild(castElement);
            });
            
            setupServers(type, content.imdb_id, content.title || content.name);
        }

        function setupVideoPlayer(type, id, imdbId) {
            const defaultServer = type === 'movie' 
                ? `https://vidsrc.cc/v2/embed/movie/${id}?autoPlay=true`
                : `https://vidsrc.cc/v2/embed/tv/${id}?autoPlay=true`;
            video.src = defaultServer;
        }

        function setupServers(type, imdbId, title) {
            serversContainer.innerHTML = '';
            const servers = type === 'movie' ? [
                { name: 'Server 1', url: `https://vidsrc.cc/v2/embed/movie/${getUrlParams().id}?autoPlay=true` },
                { name: 'Server 2', url: `https://vidsrc.me/embed/movie?tmdb=${getUrlParams().id}` },
                { name: 'Server 3', url: `https://vidsrc.xyz/embed/movie?tmdb=${getUrlParams().id}` },
                { name: 'Hindi 1', url: `https://embed.smashystream.com/dude.php?imdb=${imdbId}` },
                { name: 'Hindi 2', url: `https://autoembed.cc/movie/${getUrlParams().id}` }
            ] : [
                { name: 'Server 1', url: `https://vidsrc.cc/v2/embed/tv/${getUrlParams().id}?autoPlay=true` },
                { name: 'Server 2', url: `https://vidsrc.me/embed/tv?tmdb=${getUrlParams().id}` },
                { name: 'Server 3', url: `https://www.2embed.skin/embed/tv/${getUrlParams().id}&s=1&e=1` },
                { name: 'Server 4', url: `https://player.autoembed.cc/embed/tv/${getUrlParams().id}/1/1` }
            ];
            
            servers.forEach((server, index) => {
                const button = document.createElement('button');
                button.className = `server-button ${index === 0 ? 'active' : ''}`;
                button.textContent = server.name;
                button.onclick = () => changeServer(server.url, button);
                serversContainer.appendChild(button);
            });
        }

        function changeServer(url, button) {
            video.src = url;
            document.querySelectorAll('.server-button').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
        }

        // Content Grid Rendering (for backward compatibility)
        function renderContentGrid(content) {
            if (currentPage === 1) contentGrid.innerHTML = '';
            if (content.length === 0) {
                contentGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-secondary)">No content found</div>';
                return;
            }
            
            content.forEach(item => {
                const card = document.createElement('div');
                card.className = 'content-card';
                const itemType = item.media_type || currentType;
                card.onclick = () => updateUrl(itemType, item.id);
                
                const posterUrl = item.poster_path 
                    ? `https://image.tmdb.org/t/p/w300${item.poster_path}`
                    : 'https://i.imgur.com/eG5fXDo.png';
                
                const releaseDate = item.release_date || item.first_air_date;
                const year = releaseDate ? new Date(releaseDate).getFullYear() : '';
                const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
                
                card.innerHTML = `
                    <img src="${posterUrl}" alt="${item.title || item.name}" class="content-poster" loading="lazy" />
                    <div class="content-info">
                        <div class="content-name">${item.title || item.name}</div>
                        <div class="content-meta-small">
                            <div class="content-year">${year}</div>
                            <div class="content-rating">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="#ffd700">
                                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                                </svg>
                                ${rating}
                            </div>
                        </div>
                    </div>
                `;
                contentGrid.appendChild(card);
            });
        }

        // History Management
        function addToHistory(content, type) {
            let history = JSON.parse(localStorage.getItem('watchHistory') || '[]');
            history = history.filter(item => item.id !== content.id);
            history.unshift({
                id: content.id,
                type: type,
                title: content.title || content.name,
                poster_path: content.poster_path,
                overview: content.overview,
                timestamp: Date.now()
            });
            history = history.slice(0, 50);
            localStorage.setItem('watchHistory', JSON.stringify(history));
        }

        function loadHistoryContent() {
            const history = JSON.parse(localStorage.getItem('watchHistory') || '[]');
            historyGrid.innerHTML = '';
            if (history.length === 0) {
                historyGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-secondary)">No watch history yet</div>';
                return;
            }
            history.forEach(item => {
                const card = document.createElement('div');
                card.className = 'content-card';
                card.onclick = () => updateUrl(item.type, item.id);
                const posterUrl = item.poster_path 
                    ? `https://image.tmdb.org/t/p/w300${item.poster_path}`
                    : 'https://i.imgur.com/eG5fXDo.png';
                const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
                card.innerHTML = `
                    <img src="${posterUrl}" alt="${item.title}" class="content-poster" loading="lazy" />
                    <div class="content-info">
                        <div class="content-name">${item.title}</div>
                        <div class="content-meta-small">
                            <div class="content-year">${new Date(item.timestamp).getFullYear()}</div>
                            <div class="content-rating">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="#ffd700">
                                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                                </svg>
                                ${rating}
                            </div>
                        </div>
                    </div>
                `;
                historyGrid.appendChild(card);
            });
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear your watch history?')) {
                localStorage.removeItem('watchHistory');
                loadHistoryContent();
            }
        }

        function loadRecentsStatus() {
            const history = JSON.parse(localStorage.getItem('watchHistory') || '[]');
            historyBtn.style.display = history.length > 0 ? 'flex' : 'none';
        }

        // Utility Functions
        function goBack() {
            // Always go back in webpage history, ignore iframe history
            if (window.history.length > 1) {
                window.history.back();
            } else {
                updateUrl('home');
            }
        }

        function shareContent() {
            const params = getUrlParams();
            if (params.page && params.id) {
                const url = window.location.href;
                const title = contentTitle.textContent;
                if (navigator.share) {
                    navigator.share({ title: `${title} - Watch on AS Cineplex`, url: url });
                } else {
                    navigator.clipboard.writeText(url).then(() => alert('Link copied to clipboard!'));
                }
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => { clearTimeout(timeout); func(...args); };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // PWA Installation
        function checkInstallPrompt() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                installPromptEvent = e;
                showInstallPrompt();
            });
        }

        function showInstallPrompt() { installPrompt.classList.add('show'); }
        function hideInstallPrompt() { installPrompt.classList.remove('show'); }

        async function installApp() {
            if (!installPromptEvent) return;
            installPromptEvent.prompt();
            const { outcome } = await installPromptEvent.userChoice;
            if (outcome === 'accepted') hideInstallPrompt();
            installPromptEvent = null;
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
