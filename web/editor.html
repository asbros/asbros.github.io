<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href='https://asbros.github.io/as.webmanifest' rel='manifest'/>
<meta content='Advanced Code Editor' property='og:site_name'/>
<meta content='website' property='og:type'/>
<meta content='AS CODE EDITOR' property='og:title'/>
<meta content='The best real-time online HTML, CSS, JAVASCRIPT editor with instant live preview and with many more features.' property='og:description'/>
<meta content='https://ascodeeditor.blogspot.com/' property='og:url'/>
<meta content='Advanced Code Editor' name='title'/>
<meta content='The best real-time online HTML, CSS, JAVASCRIPT editor with instant live preview and with many more features.' name='description'/>
 <title>Advanced Code Editor</title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
 <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.0/ace.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js"></script>
 <!-- Add escomplex library -->
 <script src="https://cdn.jsdelivr.net/npm/escomplex@2.0.0/dist/escomplex.min.js"></script>
 <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-app.js"></script>
 <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-database.js"></script>
 <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-analytics.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/0.9.0rc1/jspdf.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
 <style>
  @import url('https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&display=swap');
 </style>
 <script>
  const firebaseConfig = {
    apiKey: "AIzaSyC3eZdzWCW-z9q1eluk3VCngIRJvyiRMmQ",
    authDomain: "gothic-victor-316412.firebaseapp.com",
    databaseURL: "https://gothic-victor-316412-default-rtdb.firebaseio.com",
    projectId: "gothic-victor-316412",
    storageBucket: "gothic-victor-316412.firebasestorage.app",
    messagingSenderId: "338269379488",
    appId: "1:338269379488:web:75c118b9a27bccc3aaa2c5",
    measurementId: "G-RMXHPZ4EGL"
  };
  firebase.initializeApp(firebaseConfig);
 </script>
 <style>
  #editor { position: absolute; top: 0; right: 0; bottom: 0; left: 0; }
  .header { position: fixed; top: 0; left: 0; right: 0; z-index: 999; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); padding: 10px; font-family: "Jost", serif;}
  .editor-container {
  position: fixed;
  top: 60px;
  left: 260px; /* Default position with file explorer visible */
  right: 0;
  bottom: 5px;
  transition: left 0.3s ease-in-out; /* Add transition */
  }
  editor-container.full-width {
  left: 0; /* Full width when file explorer is hidden */
  }
  
  /* Toggle Button */
  #toggleFileExplorerBtn {
  bottom: 80px;
  transition: background-color 0.3s ease-in-out; /* Smooth color change */
  }
  .preview-container { position: fixed; top: 60px; left: 0; right: 0; bottom: 0; display: none; background: white; z-index: 1000; }
  .floating-btn { position: fixed; bottom: 20px; right: 20px; z-index: 1001; width: 50px; height: 50px; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
  .settings-menu { position: fixed; top: 0; left: -300px; width: 280px; height: 100vh; z-index: 1000; transition: left 0.3s ease; background-color: #f8f9fa; border-right: 1px solid #dee2e6; overflow-y: auto; padding: 20px; padding-bottom: 120px !important; font-family: "Jost", serif;}
  .settings-menu.open { left: 0; }
  .session-item { transition: all 0.2s ease; border-radius: 8px; margin-bottom: 8px; padding: 12px; background: #fff; border: 1px solid #dee2e6; font-family: "Jost", serif;}
  .session-item:hover { transform: scale(1.05); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  .session-name { font-weight: 500; color: #2c3e50; }
  .loading-spinner { animation: spin 1s linear infinite; width: 24px; height: 24px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; margin: 20px auto; }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  .empty-state { text-align: center; padding: 20px; color: #95a5a6; }
  #undoBtn, #redoBtn { padding: 5px 10px; }
  .swal2-popup pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; max-height: 300px; white-space: pre-wrap; }
  /* Custom styles for the documentation modal */
  .swal2-title, .swal2-text, .swal2-popup .swal2-html-container {
  font-family:'Jost', sans-serif !important;
  }
  .swal2-popup .swal2-html-container {
  text-align: left !important;
  }
  
  .swal2-popup ul, .swal2-popup ol {
  padding-left: 20px;
  }
  
  .swal2-popup h5 {
  margin-top: 1rem;
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: #2c3e50;
  font-family: "Jost", serif !important;
  }
  
  .swal2-popup kbd {
  background-color: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 4px;
  padding: 2px 6px;
  font-family: monospace;
  color: #6f42c1;
  }
  .btn-purple {
  background-color: #6f42c1;
  color: white;
  }
  .btn-purple:hover {
  background-color: #5a32a3;
  color: white;
  }
  .ace_read-only .ace_cursor {
  display: none !important;
  }
  .swal2-popup .swal2-loader {
  border-color: #6f42c1 transparent #6f42c1 transparent;
  font-family: "Jost", serif !important;
  }
  .file-explorer {
  font-family: "Jost", serif;
  position: fixed;
  top: 60px;
  left: 0;
  width: 260px;
  height: calc(100vh - 60px);
  background-color: #f8f9fa;
  border-right: 1px solid #dee2e6;
  overflow-y: auto;
  padding-bottom: 120px;
  z-index: 999;
  transition: transform 0.3s ease-in-out; /* Add transition */
  }
  
  .file-explorer-header {
  padding: 10px;
  border-bottom: 1px solid #dee2e6;
  display: flex;
  justify-content: space-between;
  align-items: center;
  }
  
  .file-list {
  padding: 10px;
  }
  
  .file-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px;
  margin-bottom: 5px;
  background-color: #fff;
  border: 1px solid #dee2e6;
  border-radius: 5px;
  cursor: pointer;
  }
  
  .file-item:hover {
  background-color: #f1f1f1;
  }
  
  .file-item.active {
  background-color: #e2e2e2;
  }
  
  .file-actions {
  display: flex;
  gap: 5px;
  }
  
  .file-actions button {
  padding: 2px 5px;
  font-size: 12px;
  }
  .file-explorer.hidden {
  display: none;
  }
  .modal {
  font-family: "Jost", serif;
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 10000;
  animation: fadeIn 0.3s ease-in-out;
  }
  
  .modal.open {
  display: block;
  }
  
  .modal-dialog {
  margin: 10% auto;
  width: 95%;
  max-width: 500px;
  background-color: white;
  padding: 10px;
  border-radius: 5px;
  animation: slideIn 0.3s ease-in-out;
  }
  
  @keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
  }
  
  @keyframes slideIn {
  from { transform: translateY(-20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
  }
  #reportModal {
    font-family: "Jost", serif;
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
    z-index: 10000;
    width: 90%;
    max-width: 500px;
    animation: fadeIn 0.3s ease-in-out;
  }
  
  .modal-content {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  
  .modal-close {
    position: absolute;
    top: -10px;
    right: 10px;
    cursor: pointer;
    font-size: 28px;
  }
 </style>
</head>

<body>
 <div class="file-explorer">
  <div style="display: inline-block" class="file-explorer-header">
   <h5 class="mb-3 text-center"><i class="bi bi-folder"></i> Files Management</h5>
   <div>
    <button class="btn btn-sm btn-success me-2" id="addFileBtn">
     <i class="bi bi-plus"></i> New File
    </button>
    <button class="btn btn-sm btn-primary" id="uploadFileBtn">
     <i class="bi bi-upload"></i> Upload File
    </button>
   </div>
  </div>
  <div class="file-list" id="fileList">
   <!-- Files will be dynamically added here -->
  </div>
 </div>
 <div class="header d-flex justify-content-between align-items-center">
  <h4 id="htxt" class="mb-0">AS EDITOR</h4>
  <div>
   <button class="btn btn-sm btn-success d-none" id="refreshPreviewBtn">
    <i class="bi bi-arrow-clockwise"></i> Refresh
   </button>
   <button class="btn btn-sm btn-secondary" id="undoBtn">
    <i class="bi bi-arrow-counterclockwise"></i>
   </button>
   <button class="btn btn-sm btn-secondary" id="redoBtn">
    <i class="bi bi-arrow-clockwise"></i>
   </button>
   <button class="btn btn-sm btn-primary" id="togglePreviewBtn">
    <i class="bi bi-layout-split"></i> Show Preview
   </button>
  </div>
 </div>

 <button class="btn btn-primary floating-btn" id="toggleFileExplorerBtn" aria-label="Toggle File Explorer">
  <i class="bi bi-folder"></i>
 </button>
 <button class="btn btn-primary floating-btn" id="settingsToggleBtn" aria-label="Settings">
  <i class="bi bi-gear"></i>
 </button>

 <div class="settings-menu" id="settingsMenu" role="menu">
  <h4 class="mb-4"><i class="bi bi-gear"></i> Settings</h4>
  <div class="mb-3">
   <label class="form-label">Font Size</label>
   <select class="form-select" id="fontSize">
    <option value="12">12px</option>
    <option value="14">14px</option>
    <option value="16">16px</option>
    <option value="18">18px</option>
    <option value="20">20px</option>
   </select>
  </div>
  <div class="mb-3">
   <label class="form-label">Font Family</label>
   <select class="form-select" id="fontFamily">
    <option value="monospace">Monospace</option>
    <option value="Courier New">Courier New</option>
    <option value="Consolas">Consolas</option>
    <option value="Source Code Pro">Source Code Pro</option>
   </select>
  </div>
  <div class="mb-3">
   <label class="form-label">Theme</label>
   <select class="form-select" id="themeSelect">
    <optgroup label="Light Themes">
     <option value="chrome">Chrome</option>
     <option value="clouds">Clouds</option>
     <option value="crimson_editor">Crimson Editor</option>
    </optgroup>
    <optgroup label="Dark Themes">
     <option value="monokai">Monokai</option>
     <option value="dracula">Dracula</option>
     <option value="tomorrow_night">Tomorrow Night</option>
    </optgroup>
   </select>
  </div>

  <button class="btn btn-purple w-100 mb-3" id="writeWithAIButton">
   <i class="bi bi-robot"></i> Write code by AI
  </button>
  <button class="btn text-right btn-primary w-100 mb-3" id="importFromURL">
   <i class="bi bi-globe"></i> Import code from URL
  </button>
  <button class="btn btn-success w-100 mb-3" id="saveAndShareBtn">
   <i class="bi bi-share"></i> Save & Share code
  </button>
  <button class="btn btn-dark w-100 mb-3" id="getSavedCodeBtn">
   <i class="bi bi-folder2-open"></i> Get Saved Code
  </button>
  <button class="btn btn-warning w-100 mb-3" id="beautifyCode">
   <i class="bi bi-magic"></i> Beautify Code
  </button>
  <button class="btn btn-info w-100 mb-3" id="exportMenuBtn">
   <i class="bi bi-box-arrow-up"></i> Export Code
  </button>
  <button class="btn btn-secondary w-100 mb-3" id="saveSession">
   <i class="bi bi-save"></i> Save Session
  </button>
  <button class="btn btn-primary w-100 mb-4" id="importSessions">
   <i class="bi bi-box-arrow-down"></i> Import Sessions
  </button>
  <h5><i class="bi bi-folder"></i> Saved Sessions</h5>
  <div id="sessionsList" class="sessions-list mb-4">
   <div class="loading-spinner"></div>
  </div>
  <button class="btn btn-success w-100 mb-3" id="exportSessions">
   <i class="bi bi-box-arrow-up"></i> Export All Sessions
  </button>
  <button id="helpBtn" class="btn btn-info w-100 mb-3">
   <i class="bi bi-file-text"></i> Documentation
  </button>
  <button class="btn btn-danger w-100 mb-3" id="reportErrorBtn">
   <i class="bi bi-bug"></i> Report Error
  </button>
 </div>

 <div class="editor-container">
  <div id="editor"></div>
 </div>
 <div class="preview-container">
  <iframe class="w-100 h-100" id="preview"></iframe>
 </div>

 <!-- Add this modal at the end of the body -->
 <div id="aiModal" class="modal">
  <div class="modal-dialog">
   <div class="modal-content">
    <div class="modal-header">
     <h5 class="modal-title">Write code by AI</h5>
    </div>
    <div class="modal-body">
     <textarea type="text" id="aiInput" class="form-control" placeholder="Create a table..."></textarea>
    </div>
    <div class="modal-footer">
     <button type="button" class="btn btn-secondary" id="closeModalButton">Close</button>
     <button type="button" class="btn btn-primary" id="aiSubmitButton">Submit</button>
    </div>
   </div>
  </div>
 </div>
 <!-- Error Report Modal -->
 <div id="reportModal">
  <div class="modal-content">
   <span class="modal-close">&times;</span>
   <h4>Report Error</h4>
   <input type="text" id="reportName" class="form-control" placeholder="Your Name">
   <input type="email" id="reportEmail" class="form-control" placeholder="Your Email">
   <textarea id="reportMessage" class="form-control" rows="5" placeholder="Describe the issue..."></textarea>
   <button class="btn btn-primary" id="submitReport">Submit Report</button>
  </div>
 </div>
 <script>
  const editor = ace.edit("editor");
  editor.setTheme("ace/theme/monokai");
  editor.session.setMode("ace/mode/html");
  editor.setOptions({
      enableBasicAutocompletion: true,
      enableLiveAutocompletion: true,
      fontSize: 14,
      fontFamily: "monospace",
      useSoftTabs: true,
      wrap: true,
      displayIndentGuides: true,
      highlightGutterLine: true,
      animatedScroll: true,
  });
  ace.require("ace/ext/language_tools");
  editor.setOptions({
   enableBasicAutocompletion: true,
   enableLiveAutocompletion: true,
   enableSnippets: true
  });
  
  // Add the keydown event listener here
  document.addEventListener('keydown', (e) => {
   if (!editor.isFocused()) return;
   
   const isCtrlOrCmd = e.ctrlKey || e.metaKey;
   const isShift = e.shiftKey;
   
   if (isCtrlOrCmd && !isShift) {
  switch (e.key.toLowerCase()) {
   case 's':
    e.preventDefault();
    document.getElementById('saveSession').click();
    break;
   case 'z':
    e.preventDefault();
    editor.undo();
    break;
   case 'y':
    e.preventDefault();
    editor.redo();
    break;
   case 'p':
    e.preventDefault();
    document.getElementById('togglePreviewBtn').click();
    break;
   case 'b':
    e.preventDefault();
    document.getElementById('beautifyCode').click();
    break;
   case 'd':
    e.preventDefault();
    exportWithCustomName('txt', exportAsTxt); // Example: Export as TXT
    break;
   case 'f':
    e.preventDefault();
    editor.execCommand('find');
    break;
   case 'h':
    e.preventDefault();
    editor.execCommand('replace');
    break;
   case 'g':
    e.preventDefault();
    editor.execCommand('gotoline');
    break;
   case 'l':
    e.preventDefault();
    editor.execCommand('selectline');
    break;
   case '/':
    e.preventDefault();
    editor.execCommand('togglecomment');
    break;
  }
   }
   
   // Handle navigation shortcuts
   if (isCtrlOrCmd) {
  switch (e.key.toLowerCase()) {
   case 'home':
    e.preventDefault();
    editor.navigateFileStart();
    break;
   case 'end':
    e.preventDefault();
    editor.navigateFileEnd();
    break;
  }
   }
   
   // Handle Alt + Up/Down for moving lines
   if (e.altKey) {
  switch (e.key.toLowerCase()) {
   case 'arrowup':
    e.preventDefault();
    editor.execCommand('movelinesup');
    break;
   case 'arrowdown':
    e.preventDefault();
    editor.execCommand('movelinesdown');
    break;
  }
   }
  });
  
  // ======== Storage Management Helpers ======== //
  function getLocalStorageSize() {
    let total = 0;
    for (const key in localStorage) {
        if (localStorage.hasOwnProperty(key)) {
            total += (localStorage[key].length * 2);
        }
    }
    return total; // Returns size in bytes
  }
  
  function checkStorageLimit() {
    const maxSize = 4.5 * 1024 * 1024; // 4.5MB threshold
    const currentSize = getLocalStorageSize();
    
    if (currentSize >= maxSize) {
        Swal.fire({
            icon: 'warning',
            title: 'Storage Almost Full',
            html: `You've used ${(currentSize/1024/1024).toFixed(2)}MB of 5MB.<br>
                 Delete old sessions to free up space.`,
            confirmButtonText: 'Manage Sessions',
            showCancelButton: true,
            cancelButtonText: 'Dismiss'
        }).then((result) => {
            if (result.isConfirmed) {
                document.getElementById('settingsMenu').classList.add('open');
            }
        });
        return true;
    }
    return false;
  }
  
  const savedContent = localStorage.getItem('editorContent');
   editor.setValue(savedContent || "");
   editor.clearSelection();
  
  //Update preview
  function updatePreview() {
   const code = editor.getValue();
   const iframe = document.getElementById('preview');
   const blob = new Blob([code], { type: 'text/html' });
   iframe.src = URL.createObjectURL(blob);
  }
  
  document.getElementById('undoBtn').addEventListener('click', () => editor.undo());
  document.getElementById('redoBtn').addEventListener('click', () => editor.redo());
  
  let isPreviewVisible = false;
  document.getElementById('togglePreviewBtn').addEventListener('click', () => {
   isPreviewVisible = !isPreviewVisible;
   document.querySelector('.editor-container').style.display = isPreviewVisible ? 'none' : 'block';
   document.querySelector('.preview-container').style.display = isPreviewVisible ? 'block' : 'none';
   document.getElementById('togglePreviewBtn').innerHTML = isPreviewVisible ?
  '<i class="bi bi-code-square"></i> Show Editor' :
  '<i class="bi bi-layout-split"></i> Show Preview';
   document.getElementById('htxt').innerText = isPreviewVisible ?
  '$ PREVIEWER' :
  'AS EDITOR';
   document.getElementById('refreshPreviewBtn').classList.toggle('d-none', !isPreviewVisible);
   document.getElementById('settingsToggleBtn').style.display = isPreviewVisible ? 'none' : 'block';
   document.getElementById('toggleFileExplorerBtn').style.display = isPreviewVisible ? 'none' : 'block';
   document.getElementById('undoBtn').style.display = isPreviewVisible ? 'none' : 'inline-block';
   document.getElementById('redoBtn').style.display = isPreviewVisible ? 'none' : 'inline-block';
   
   if (isPreviewVisible) {
  // Update preview when switching to preview mode
  updatePreview();
   } else {
  // Clear the preview when switching back to editor mode
  const iframe = document.getElementById('preview');
  iframe.src = ''; // Clear the iframe source
   }
  });
  
  // Manual refresh functionality
  document.getElementById('refreshPreviewBtn').addEventListener('click', updatePreview);
  
  // Update preview function remains the same
  function updatePreview() {
   const code = editor.getValue();
   const iframe = document.getElementById('preview');
   const blob = new Blob([code], { type: 'text/html' });
   iframe.src = URL.createObjectURL(blob);
  }
  
  document.getElementById('settingsToggleBtn').addEventListener('click', () => {
      document.getElementById('settingsMenu').classList.toggle('open');
  });
  
  document.addEventListener('click', (e) => {
      if (!e.target.closest('#settingsMenu') && !e.target.closest('#settingsToggleBtn')) {
          document.getElementById('settingsMenu').classList.remove('open');
      }
  });
  
  document.getElementById('fontSize').addEventListener('change', (e) => {
      const fontSize = e.target.value;
      editor.setFontSize(fontSize);
      localStorage.setItem('editorFontSize', fontSize);
  });
  
  document.getElementById('fontFamily').addEventListener('change', (e) => {
      const fontFamily = e.target.value;
      editor.setOptions({ fontFamily });
      localStorage.setItem('editorFontFamily', fontFamily);
      const iframe = document.getElementById('preview');
      iframe.contentDocument.body.style.fontFamily = fontFamily;
  });
  
  document.getElementById('themeSelect').addEventListener('change', (e) => {
      const theme = e.target.value;
      editor.setTheme(`ace/theme/${theme}`);
      localStorage.setItem('editorTheme', theme);
  });
  
  document.getElementById('beautifyCode').addEventListener('click', () => {
      editor.setValue(html_beautify(editor.getValue(),{"indent_size":  "1","indent_scripts": "normal"}));editor.clearSelection();
  });
  
  
  // Modified session storage functions
  const SESSION_PREFIX = 'session-';
  
  function saveSession(sessionName) {
    const content = editor.getValue().trim();
    if (!content) return Swal.fire({ 
        icon: 'error', 
        title: 'Empty Content', 
        text: 'Please write something before saving!' 
    });
  
    // Storage check before saving
    if (checkStorageLimit()) return;
  
    const sessions = JSON.parse(localStorage.getItem('savedSessions') || '[]');
    
    // Auto-delete oldest if over 20 sessions
    if (sessions.length >= 20) {
        const oldestSession = sessions.shift();
        localStorage.removeItem(`${SESSION_PREFIX}${oldestSession}`);
    }
    
    if (sessions.some(s => s.toLowerCase() === sessionName.toLowerCase())) return Swal.fire({ 
        icon: 'error', 
        title: 'Duplicate Name', 
        text: 'Session name already exists!' 
    });
  
    sessions.push(sessionName);
    localStorage.setItem('savedSessions', JSON.stringify(sessions));
    localStorage.setItem(`${SESSION_PREFIX}${sessionName}`, content);
    loadSessionsList();
  
    // Final storage check after saving
    checkStorageLimit();
  }
  
  function loadSessionsList() {
    const sessions = JSON.parse(localStorage.getItem('savedSessions') || '[]');
    const sessionsList = document.getElementById('sessionsList');
    setTimeout(() => {
        sessionsList.innerHTML = sessions.length > 0 ? sessions.map(session => `
            <div class="session-item">
                <div class="justify-content-between align-items-center">
                    <div style="margin-bottom: 5px;" class="d-flex">
                        <i class="bi bi-file-earmark-code me-2"></i>
                        <span class="session-name" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">${session}</span>
                        <small class="text-muted ms-2">
                            ${(localStorage.getItem(`${SESSION_PREFIX}${session}`)?.length / 1024 || 0).toFixed(1)}KB
                        </small>
                    </div>
                    <div>
                        <button class="btn btn-sm btn-primary me-2" onclick="handleSessionClick('${session}')">
                            <i class="bi bi-folder2-open"></i>
                        </button>
                        <button class="btn btn-sm btn-warning me-2" onclick="renameSession('${session}')">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSession('${session}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>`).join('') : `<div class="empty-state"><i class="bi bi-folder-x fs-4"></i><div class="mt-2">No saved sessions</div></div>`;
    }, 500);
  }
  
  async function handleSessionClick(sessionName) {
   const { isConfirmed } = await Swal.fire({
  title: 'Load Session?',
  text: `Load "${sessionName}" as a new file?`,
  icon: 'question',
  showCancelButton: true
   });
   
   if (isConfirmed) {
  const sessionData = localStorage.getItem(`${SESSION_PREFIX}${sessionName}`);
  if (sessionData) {
   // Create new file with session name and content
   fileExplorer.addFile(sessionName, sessionData);
   Swal.fire({
    title: 'Loaded!',
    text: `"${sessionName}" created as a new file`,
    icon: 'success',
    timer: 2000
   });
  }
   }
  }
  
  async function renameSession(oldName) {
      const { value: newName } = await Swal.fire({
          title: 'Rename Session',
          input: 'text',
          inputValue: oldName,
          inputValidator: (value) => !value && 'Name cannot be empty!'
      });
      if (newName && newName !== oldName) {
          const content = localStorage.getItem(`${SESSION_PREFIX}${oldName}`); // Changed to localStorage
    localStorage.setItem(`${SESSION_PREFIX}${newName}`, content); // Changed to localStorage
    localStorage.removeItem(`${SESSION_PREFIX}${oldName}`); // Changed to localStorage
    const sessions = JSON.parse(localStorage.getItem('savedSessions')); // Changed to localStorage
          sessions[sessions.indexOf(oldName)] = newName;
    localStorage.setItem('savedSessions', JSON.stringify(sessions));
          loadSessionsList();
      }
  }
  
  async function deleteSession(sessionName) {
      const { isConfirmed } = await Swal.fire({
          title: 'Delete Session?',
          text: `Delete "${sessionName}" permanently?`,
          icon: 'warning',
          showCancelButton: true
      });
      if (isConfirmed) {
          localStorage.removeItem(`${SESSION_PREFIX}${sessionName}`); // Changed to localStorage
    const sessions = JSON.parse(localStorage.getItem('savedSessions') || '[]') // Changed to localStorage
        .filter(name => name !== sessionName);
    localStorage.setItem('savedSessions', JSON.stringify(sessions)); // Changed to localStorage
          loadSessionsList();
          Swal.fire('Deleted!', 'Session removed', 'success');
      }
  }
  
  document.getElementById('saveSession').addEventListener('click', async () => {
      const { value: sessionName } = await Swal.fire({
          title: 'Save Session',
          input: 'text',
          inputLabel: 'Session name:',
          showCancelButton: true,
          inputValidator: (value) => {if (!value) return 'Name required!';if (value.length > 20) return 'Max 20 characters!';if (/[^a-z0-9]/i.test(value)) return 'Alphanumeric only!';}
      });
      if (sessionName) saveSession(sessionName);
      });
  
      document.addEventListener('DOMContentLoaded', () => {
  loadSessionsList();
  const savedFontSize = localStorage.getItem('editorFontSize') || '14';
  const savedFontFamily = localStorage.getItem('editorFontFamily') || 'monospace';
  const savedTheme = localStorage.getItem('editorTheme') || 'monokai';
  editor.setFontSize(savedFontSize);
  editor.setOptions({ fontFamily: savedFontFamily });
  editor.setTheme(`ace/theme/${savedTheme}`);
  document.getElementById('fontSize').value = savedFontSize;
  document.getElementById('fontFamily').value = savedFontFamily;
  document.getElementById('themeSelect').value = savedTheme;
      });
  
  //Import from url
  document.getElementById('importFromURL').addEventListener('click', async () => {
   const { value: url } = await Swal.fire({
  title: 'Import from URL',
  input: 'url',
  inputLabel: 'Website URL:',
  inputPlaceholder: 'https://example.com',
  showCancelButton: true,
  inputValidator: (value) => {
   try {
    new URL(value); // Validate the URL
    return;
   } catch {
    return 'Invalid URL!'; // Show error if URL is invalid
   }
  },
   });
   
   if (url) {
  try {
   Swal.fire({ title: 'Loading...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
   
   // Use the previous proxy URL
   const proxyUrl = 'https://api.codetabs.com/v1/proxy?quest=';
   const fullUrl = proxyUrl + encodeURIComponent(url); // Encode the URL to handle special characters
   
   // Fetch the content from the URL using the proxy
   const response = await fetch(fullUrl);
   
   // Check if the response is OK (status code 200-299)
   if (!response.ok) {
    throw new Error(`Failed to fetch: HTTP ${response.status}`);
   }
   
   // Read the raw content (no content type validation)
   const content = await response.text();
   
   // Check if "Imported code from URL" file exists
   const importFile = fileExplorer.files.find((file) => file.name === 'Imported code from URL');
   
   if (importFile) {
    // If the file exists, clear its content and update it with the new imported content
    importFile.content = content;
    fileExplorer.switchFile(importFile.id); // Switch to the "Imported code from URL" file
   } else {
    // If the file doesn't exist, create it and add the imported content
    fileExplorer.addFile('Imported code from URL', content);
   }
   
   // Update the editor with the imported content
   editor.setValue(content);
   editor.clearSelection();
   
   // Close the loading indicator and show success message
   Swal.close();
   Swal.fire({ icon: 'success', title: 'Success!', text: 'The content has been imported successfully.', timer: 2000 });
  } catch (error) {
   // Close the loading indicator and show error message
   Swal.close();
   Swal.fire({
    icon: 'error',
    title: 'Import Failed',
    html: `<small>${error.message}</small>`,
   });
  }
   }
  });
 </script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 <script>
  function getLocalStorageSize() {
    let total = 0;
    for (const key in localStorage) {
      if (localStorage.hasOwnProperty(key) && 
     (key.startsWith(SESSION_PREFIX) || key === 'editorContent')) {
   total += (localStorage[key].length * 2);
      }
    }
    return total;
  }
  
  document.getElementById('importSessions').addEventListener('click', async () => {
  try {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'application/json';
    
    input.onchange = async (e) => {
      try {
        const file = e.target.files[0];
        if (!file) return;
  
        // Read and parse the file
        const text = await file.text();
        const importedData = JSON.parse(text);
        
        // Validate the imported data
        if (!Array.isArray(importedData)) {
          throw new Error('Invalid session file format. Expected an array of sessions.');
        }
  
        // Get existing sessions or initialize an empty array if none exist
        const existingSessions = JSON.parse(localStorage.getItem('savedSessions') || '[]');
        let importedCount = 0;
        let skippedCount = 0;
  
        // Process each session
        for (const session of importedData) {
          // Validate session structure
          if (!session?.name || !session?.content) {
            skippedCount++;
            continue;
          }
  
          // Clean session name
          let cleanName = session.name.trim().slice(0, 20);
          
          // Handle duplicates by appending a counter
          let finalName = cleanName;
          let counter = 1;
          
          while (existingSessions.some(s => s.toLowerCase() === finalName.toLowerCase())) {
            finalName = `${cleanName} (${counter++})`;
          }
  
          // Save the session
          localStorage.setItem(`${SESSION_PREFIX}${finalName}`, session.content);
          existingSessions.push(finalName);
          importedCount++;
        }
  
        // Update the saved sessions list in localStorage
        localStorage.setItem('savedSessions', JSON.stringify(existingSessions));
        
        // Reload the sessions list in the UI
        loadSessionsList();
  
        // Show success message
        Swal.fire({
          icon: 'success',
          title: 'Import Complete',
          html: `Imported ${importedCount} sessions<br>
                ${skippedCount} invalid entries skipped`,
          footer: '<small>Duplicate names were automatically renamed</small>'
        });
  
      } catch (error) {
        Swal.fire('Import Failed', error.message, 'error');
      }
    };
  
    // Trigger the file input dialog
    input.click();
  
  } catch (error) {
    Swal.fire('Import Error', error.message, 'error');
  }
  });
  
  document.getElementById('exportSessions').addEventListener('click', () => {
  try {
    const sessions = JSON.parse(localStorage.getItem('savedSessions') || []);
    if (sessions.length === 0) {
      Swal.fire('No Sessions', 'There are no sessions to export.', 'info');
      return;
    }
  
    const data = sessions.map(name => {
      const content = localStorage.getItem(`${SESSION_PREFIX}${name}`);
      return content ? { name, content } : null;
    }).filter(Boolean);
  
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `sessions-${new Date().toISOString().slice(0,10)}.json`;
    a.click();
    URL.revokeObjectURL(url);
    Swal.fire('Exported!', `${data.length} sessions exported.`, 'success');
  } catch (error) {
    Swal.fire('Export Failed', error.message, 'error');
  }
  });
  
  
 </script>
 <script>
  //save and share 
  document.getElementById('saveAndShareBtn').addEventListener('click', async () => {
  const content = editor.getValue().trim();
  
  // Check if editor is empty
  if (!content) {
   Swal.fire({
    icon: 'error',
    title: 'Empty Content',
    text: 'Please write something before saving and sharing!'
   });
   return;
  }
  
  // Get name from user
  const { value: name } = await Swal.fire({
   title: 'Save & Share',
   input: 'text',
   text: 'Enter a name for your code (no special characters or spaces):',
   inputValidator: (value) => {
    if (!value) return 'Name is required!';
    if (/[ .$#\[\]/]/.test(value)) return 'Invalid characters in name!';
   }
  });
  
  if (name) {
   const uppercaseName = name.toUpperCase();
   
   try {
    // Check if name already exists in Firebase
    const snapshot = await firebase.database().ref(`codes/${uppercaseName}`).once('value');
    if (snapshot.exists()) {
     Swal.fire({
      icon: 'error',
      title: 'Name Exists',
      text: 'This name is already taken! Please use a different name.'
     });
     return;
    }
    
    // Get permissions if name is unique
    const { value: permission } = await Swal.fire({
     title: 'Set Permissions',
     input: 'select',
     inputOptions: { edit: 'Allow Editing', view: 'View Only' },
     inputLabel: 'Choose sharing permissions:',
     showCancelButton: true
    });
    
    if (permission) {
     Swal.fire({ title: 'Saving...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
     
     // Save to Firebase
     await firebase.database().ref(`codes/${uppercaseName}`).set({
      code: editor.getValue(),
      permission
     });
     
     // Generate and copy share link
     const shareLink = `${window.location.origin}${window.location.pathname}?shared=${uppercaseName}`;
     await navigator.clipboard.writeText(shareLink);
     
     Swal.fire({
      icon: 'success',
      title: 'Saved & Shared!',
      html: `Link copied to clipboard:<br><a href="${shareLink}" target="_blank">${shareLink}</a>`
     });
    }
   } catch (error) {
    console.error('Firebase Error:', error);
    Swal.fire('Error', `Operation failed: ${error.message}`, 'error');
   }
  }
  });
   
   //shared code file creation
  document.addEventListener('DOMContentLoaded', () => {
  const urlParams = new URLSearchParams(window.location.search);
  const sharedName = urlParams.get('shared');
  
  if (sharedName) {
   firebase.database().ref(`codes/${sharedName}`).once('value')
    .then((snapshot) => {
     const data = snapshot.val();
     if (data && data.code) {
      // Create a new file in the file explorer with the shared file's name and content
      fileExplorer.addFile(sharedName, data.code);
      
      // Set the editor content
      editor.setValue(data.code);
      editor.clearSelection();
      
      if (data.permission === 'view') {
       editor.setReadOnly(true);
       Swal.fire('Info', 'This code is view-only. Editing is disabled.', 'info');
      }
     } else {
      Swal.fire('Error', 'Shared code not found.', 'error');
     }
    })
    .catch((error) => {
     console.error('Firebase Error:', error);
     Swal.fire('Error', 'Failed to load shared code. Please try again later.', 'error');
    });
  }
  });
   
   //get saved code
   document.getElementById('getSavedCodeBtn').addEventListener('click', async () => {
  // Ask for the name of the saved code
  const { value: name } = await Swal.fire({
   title: 'Get Saved Code',
   input: 'text',
   inputLabel: 'Enter the name of the saved code:',
   inputValidator: (value) => {
    if (!value) return 'Name is required!';
   }
  });
  
  if (name) {
   // Normalize the name to lowercase for case-insensitive comparison
   const normalizedName = name.toLowerCase();
   
   try {
    // Fetch all saved codes from Firebase
    const snapshot = await firebase.database().ref('codes').once('value');
    const codes = snapshot.val() || {};
    
    // Find the matching name (case-insensitive)
    const matchedKey = Object.keys(codes).find(
     (key) => key.toLowerCase() === normalizedName
    );
    
    if (matchedKey) {
     // If a match is found, create a new file with the matched name and content
     const code = codes[matchedKey].code;
     fileExplorer.addFile(matchedKey, code); // Create a new file with the matched name and content
     
     // Show success toast
     Swal.fire({
      icon: 'success',
      title: 'Code Loaded!',
      text: `Code "${matchedKey}" has been loaded into a new file.`,
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: 3000
     });
    } else {
     // If no match is found, show an error toast
     Swal.fire({
      icon: 'error',
      title: 'No Code Found',
      text: `No code found with the name "${name}".`,
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: 3000
     });
    }
   } catch (error) {
    console.error('Firebase Error:', error);
    Swal.fire('Error', 'Failed to fetch saved code.', 'error');
   }
  }
  });
 </script>

 <script>
  // Utility function for custom file names
  async function exportWithCustomName(format, exportFunction) {
      const { value: fileName } = await Swal.fire({
     title: 'Export Code',
     input: 'text',
     inputLabel: 'Enter file name:',
     inputValue: `code.${format}`,
     showCancelButton: true,
     inputValidator: (value) => !value && 'Please enter a file name!'
      });
      if (fileName) {
     exportFunction(fileName);
      }
  }
  
  // Utility function to check if the editor is empty
  function isEditorEmpty() {
   return editor.getValue().trim() === '';
  }
  
  // Show an alert if the editor is empty
  function alertEditorEmpty() {
   Swal.fire({
  icon: 'error',
  title: 'Empty Editor',
  text: 'Please write something in the editor before exporting!',
   });
  }
  
  // Export as TXT
  function exportAsTxt(fileName = 'code.txt') {
   if (isEditorEmpty()) {
  alertEditorEmpty();
  return;
   }
   const code = editor.getValue();
   const blob = new Blob([code], { type: 'text/plain' });
   const url = URL.createObjectURL(blob);
   const a = document.createElement('a');
   a.href = url;
   a.download = fileName;
   a.click();
   URL.revokeObjectURL(url);
  }
  
  // Export as HTML
  function exportAsHtml(fileName = 'code.html') {
   if (isEditorEmpty()) {
  alertEditorEmpty();
  return;
   }
   const code = editor.getValue();
   const htmlContent = `${code}`;
   const blob = new Blob([htmlContent], { type: 'text/html' });
   const url = URL.createObjectURL(blob);
   const a = document.createElement('a');
   a.href = url;
   a.download = fileName;
   a.click();
   URL.revokeObjectURL(url);
  }
  
  // Export as PDF
  function exportAsPdf(fileName = 'code.pdf') {
   if (isEditorEmpty()) {
  alertEditorEmpty();
  return;
   }
   const code = editor.getValue();
   const doc = new jsPDF();
   doc.setFontSize(12);
   doc.text(code, 10, 10);
   doc.save(fileName);
  }
  
  // Export as Markdown
  function exportAsMarkdown(fileName = 'code.md') {
   if (isEditorEmpty()) {
  alertEditorEmpty();
  return;
   }
   const code = editor.getValue();
   const blob = new Blob([code], { type: 'text/markdown' });
   const url = URL.createObjectURL(blob);
   const a = document.createElement('a');
   a.href = url;
   a.download = fileName;
   a.click();
   URL.revokeObjectURL(url);
  }
  
  // Export as JSON
  function exportAsJson(fileName = 'code.json') {
   if (isEditorEmpty()) {
  alertEditorEmpty();
  return;
   }
   const code = editor.getValue();
   const json = JSON.stringify({ code }, null, 2);
   const blob = new Blob([json], { type: 'application/json' });
   const url = URL.createObjectURL(blob);
   const a = document.createElement('a');
   a.href = url;
   a.download = fileName;
   a.click();
   URL.revokeObjectURL(url);
  }
  
  // Export as Image
  function exportAsImage(format = 'png', fileName = `code.${format}`) {
   if (isEditorEmpty()) {
  alertEditorEmpty();
  return;
   }
   html2canvas(document.querySelector('#editor')).then(canvas => {
  const imgData = canvas.toDataURL(`image/${format}`);
  const a = document.createElement('a');
  a.href = imgData;
  a.download = fileName;
  a.click();
   });
  }
  
  // Export menu
  document.getElementById('exportMenuBtn').addEventListener('click', () => {
   Swal.fire({
  title: 'Export Code',
  html: `
            <div class="mb-3">
                <label class="form-label">Select Format</label>
                <select class="form-select" id="exportFormat">
                    <option value="pdf">PDF</option>
                    <option value="markdown">Markdown</option>
                    <option value="json">JSON</option>
                    <option value="txt">TXT</option>
                    <option value="html">HTML</option>
                    <option value="png">PNG</option>
                    <option value="jpeg">JPEG</option>
                </select>
            </div>
        `,
  showCancelButton: true,
  confirmButtonText: 'Export',
  preConfirm: () => {
   const format = document.getElementById('exportFormat').value;
   return format;
  }
   }).then((result) => {
  if (result.isConfirmed) {
   const format = result.value;
   switch (format) {
    case 'pdf':
     exportWithCustomName('pdf', exportAsPdf);
     break;
    case 'markdown':
     exportWithCustomName('md', exportAsMarkdown);
     break;
    case 'json':
     exportWithCustomName('json', exportAsJson);
     break;
    case 'txt':
     exportWithCustomName('txt', exportAsTxt);
     break;
    case 'html':
     exportWithCustomName('html', exportAsHtml);
     break;
    case 'png':
     exportWithCustomName('png', (fileName) => exportAsImage('png', fileName));
     break;
    case 'jpeg':
     exportWithCustomName('jpeg', (fileName) => exportAsImage('jpeg', fileName));
     break;
   }
  }
   });
  });
  
  //help Button
  document.getElementById('helpBtn').addEventListener('click', () => {
   Swal.fire({
  title: 'Editor Documentation',
  html: `
      <div class="text-start" style="max-height: 70vh; overflow-y: auto;">
        <h5 class="text-purple"><i class="bi bi-gear"></i> Core Features</h5>
        <ul class="list-unstyled">
          <li><strong>Multi-file Management:</strong> Create, rename, delete, and organize files in the collapsible file explorer</li>
          <li><strong>AI Code Generation:</strong> Generate complete HTML/CSS/JS implementations using natural language prompts</li>
          <li><strong>Real-time Preview:</strong> Instant HTML rendering with toggleable preview pane</li>
          <li><strong>Code Analysis:</strong> Built-in complexity metrics and error checking</li>
          <li><strong>Cloud Integration:</strong> Save/load code to Firebase with shareable links</li>
          <li><strong>Export Options:</strong> Export as PDF, Image, Markdown, JSON, TXT, or HTML</li>
          <li><strong>Session Management:</strong> Save/load workspace states with auto-versioning</li>
          <li><strong>Collaboration:</strong> Share code with view-only or edit permissions</li>
        </ul>
        
        <h5 class="text-purple mt-4"><i class="bi bi-lightbulb"></i> Usage Guide</h5>
        <ol>
          <li>Use the file explorer (left pane) to manage multiple code files</li>
          <li>Access AI code generation through the robot icon</li>
          <li>Right-click in editor for context-aware code actions</li>
          <li>Drag-and-drop files into the editor for quick imports</li>
          <li>Use the session manager to save/load workspace states</li>
          <li>Enable collaborative editing through shareable links</li>
          <li>Report issues directly through the bug icon in settings</li>
        </ol>
      </div>
    `,
  width: '800px',
  confirmButtonText: 'Got It!',
  customClass: {
   popup: 'documentation-popup',
   htmlContainer: 'documentation-content'
  }
   });
  });
  
  // File Explorer Logic
  const fileExplorer = {
   files: [], // Array to store file data
   currentFile: null, // Currently active file
   defaultFiles: ['Code generated by AI', 'Imported code from URL'], // Default files that cannot be deleted
   
   // Initialize file explorer
   init() {
  this.loadFiles();
  
  // Add default files if they don't exist
  this.defaultFiles.forEach((fileName) => {
   if (!this.files.some((file) => file.name === fileName)) {
    this.addFile(fileName, '');
   }
  });
  
  if (this.files.length === 0) {
   const defaultContent = localStorage.getItem('defaultEditorContent');
   if (defaultContent) {
    editor.setValue(defaultContent);
    editor.clearSelection();
   }
  } else {
   // Existing code to set first file's content
   this.currentFile = this.files[0].id;
   editor.setValue(this.files[0].content);
   editor.clearSelection();
  }
  this.renderFileList();
  this.setupEventListeners();
   },
   
   // Load files from localStorage
   loadFiles() {
  const savedFiles = JSON.parse(localStorage.getItem('files')) || [];
  this.files = savedFiles;
   },
   
   // Save files to localStorage
   saveFiles() {
  localStorage.setItem('files', JSON.stringify(this.files));
   },
   
   // Render file list in the sidebar
   renderFileList() {
   const fileList = document.getElementById('fileList');
   fileList.innerHTML = this.files
  .map(
   (file) => `
                <div class="file-item ${file.id === this.currentFile ? 'active' : ''}" data-id="${file.id}">
                    <span style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;" class="file-name">${file.name}</span>
                    <div class="file-actions">
                        ${!this.defaultFiles.includes(file.name) ? `
                        <button class="btn btn-sm btn-warning rename-file" title="Rename">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-file" title="Delete">
                            <i class="bi bi-trash"></i>
                        </button>
                        ` : ''}
                    </div>
                </div>
            `
  )
  .join('');
  },
   
   // Generate a unique file name by appending a number if the name already exists
   generateUniqueFileName(baseName) {
   let newName = baseName;
   let counter = 1;
   
   // Check if the name already exists
   while (this.files.some((file) => file.name === newName)) {
  newName = `${baseName} (${counter})`;
  counter++;
   }
   
   return newName;
  },
   
   // Add a new file
  addFile(name = 'Untitled', content = '') {
   // Generate a unique file name if the name already exists
   const uniqueName = this.generateUniqueFileName(name);
   
   // Create a new file
   const newFile = {
  id: Date.now().toString(),
  name: uniqueName,
  content: content,
   };
   this.files.push(newFile);
   this.currentFile = newFile.id;
   this.saveFiles();
   this.renderFileList();
   editor.setValue(newFile.content);
   editor.clearSelection();
  },
   
   // Rename a file
   renameFile(fileId, newName) {
  const file = this.files.find((f) => f.id === fileId);
  if (file && !this.defaultFiles.includes(file.name)) {
   // Generate a unique file name
   const uniqueName = this.generateUniqueFileName(newName);
   
   file.name = uniqueName;
   this.saveFiles();
   this.renderFileList();
  } else {
   Swal.fire({
    icon: 'error',
    title: 'Cannot Rename',
    text: 'This file cannot be renamed.',
   });
  }
   },
   
   // Delete a file
   deleteFile(fileId) {
  const file = this.files.find((f) => f.id === fileId);
  if (file && !this.defaultFiles.includes(file.name)) {
   this.files = this.files.filter((f) => f.id !== fileId);
   if (this.currentFile === fileId) {
    this.currentFile = this.files.length > 0 ? this.files[0].id : null;
    editor.setValue(this.files.length > 0 ? this.files[0].content : '');
    editor.clearSelection();
   }
   this.saveFiles();
   this.renderFileList();
   
   // Restore default storage if all files are deleted
   if (this.files.length === 0) {
    const currentContent = editor.getValue();
    localStorage.setItem('defaultEditorContent', currentContent);
   }
  } else {
   Swal.fire({
    icon: 'error',
    title: 'Cannot Delete',
    text: 'This file cannot be deleted.',
   });
  }
   },
   
   // Switch to a file
   switchFile(fileId) {
  const file = this.files.find((f) => f.id === fileId);
  if (file) {
   this.currentFile = fileId;
   editor.setValue(file.content);
   editor.clearSelection();
   this.renderFileList();
  }
   },
   
   // Save current file content
   saveCurrentFile() {
  if (this.files.length === 0) {
   const content = editor.getValue();
   localStorage.setItem('defaultEditorContent', content);
  } else {
   const file = this.files.find((f) => f.id === this.currentFile);
   if (file) {
    file.content = editor.getValue();
    this.saveFiles();
   }
  }
   },
   
   // Set up event listeners
   setupEventListeners() {
  // Add new file with name prompt
  document.getElementById('addFileBtn').addEventListener('click', async () => {
  const { value: fileName } = await Swal.fire({
    title: 'New File',
    input: 'text',
    inputLabel: 'Enter file name:',
    inputPlaceholder: 'e.g., index.html',
    showCancelButton: true,
    inputValidator: (value) => {
      if (!value) return 'File name cannot be empty!';
      if (value.length > 50) return 'File name must be less than 50 characters!';
    }
  });
  
  if (fileName) {
    fileExplorer.addFile(fileName); // Create the file with the provided name
  }
  });
  
  // Upload file (text-only)
  document.getElementById('uploadFileBtn').addEventListener('click', () => {
   const input = document.createElement('input');
   input.type = 'file';
   input.accept = '.html,.css,.js,.txt,.json,.md'; // Only accept text-related files
   input.multiple = true; // Allow multiple files to be uploaded
   
   input.onchange = (e) => {
    const files = e.target.files;
    for (let i = 0; i < files.length; i++) {
     const file = files[i];
     
     // Validate file type (only allow text-based files)
     if (!file.type.startsWith('text/') && !['application/json', 'application/javascript'].includes(file.type)) {
      Swal.fire({
       icon: 'error',
       title: 'Invalid File Type',
       text: `"${file.name}" is not a text-based file. Only HTML, CSS, JS, TXT, JSON, and MD files are allowed.`,
      });
      continue; // Skip non-text files
     }
     
     const reader = new FileReader();
     
     reader.onload = (event) => {
      const fileContent = event.target.result;
      this.addFile(file.name, fileContent);
      
      // Automatically load the first uploaded file into the editor
      if (i === 0) {
       editor.setValue(fileContent);
       editor.clearSelection();// Load the file content into the editor
      }
     };
     
     reader.readAsText(file); // Read the file as text
    }
   };
   
   input.click(); // Trigger the file input dialog
  });
  
  // Switch file
  document.getElementById('fileList').addEventListener('click', (e) => {
   const fileItem = e.target.closest('.file-item');
   if (fileItem) {
    const fileId = fileItem.dataset.id;
    this.switchFile(fileId);
   }
  });
  
  // Rename file
  document.getElementById('fileList').addEventListener('click', (e) => {
   if (e.target.closest('.rename-file')) {
    const fileItem = e.target.closest('.file-item');
    const fileId = fileItem.dataset.id;
    const file = this.files.find((f) => f.id === fileId);
    if (!this.defaultFiles.includes(file.name)) {
     Swal.fire({
      title: 'Rename File',
      input: 'text',
      inputValue: file.name,
      showCancelButton: true,
      inputValidator: (value) => {
       if (!value) return 'File name cannot be empty!';
      },
     }).then((result) => {
      if (result.isConfirmed) {
       this.renameFile(fileId, result.value);
      }
     });
    } else {
     Swal.fire({
      icon: 'error',
      title: 'Cannot Rename',
      text: 'This file cannot be renamed.',
     });
    }
   }
  });
  
  // Delete file
  document.getElementById('fileList').addEventListener('click', (e) => {
   if (e.target.closest('.delete-file')) {
    const fileItem = e.target.closest('.file-item');
    const fileId = fileItem.dataset.id;
    const file = this.files.find((f) => f.id === fileId);
    if (!this.defaultFiles.includes(file.name)) {
     Swal.fire({
      title: 'Delete File?',
      text: 'This action cannot be undone!',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Delete',
     }).then((result) => {
      if (result.isConfirmed) {
       this.deleteFile(fileId);
      }
     });
    } else {
     Swal.fire({
      icon: 'error',
      title: 'Cannot Delete',
      text: 'This file cannot be deleted.',
     });
    }
   }
  });
  
  // Save file content on editor change
  editor.session.on('change', () => {
   this.saveCurrentFile();
  });
   },
  };
  
  // Initialize file explorer
  fileExplorer.init();
  
  //toggle file explorer
  document.getElementById('toggleFileExplorerBtn').addEventListener('click', () => {
  const fileExplorer = document.querySelector('.file-explorer');
  fileExplorer.classList.toggle('hidden');
  document.getElementById('toggleFileExplorerBtn').classList.toggle('active');
  
  const editorContainer = document.querySelector('.editor-container');
  if (fileExplorer.classList.contains('hidden')) {
    editorContainer.style.left = '0';
  } else {
    editorContainer.style.left = '260px';
  }
  });
 </script>
 <script>
  // Open the AI modal with animation
  document.getElementById('writeWithAIButton').addEventListener('click', () => {
  const modal = document.getElementById('aiModal');
  modal.classList.add('open');
  document.getElementById('aiInput').focus();
  });
  
  // Close the modal with animation
  document.getElementById('closeModalButton').addEventListener('click', () => {
  const modal = document.getElementById('aiModal');
  modal.classList.remove('open');
  });
  
  // Handle AI query submission
  document.getElementById('aiSubmitButton').addEventListener('click', async () => {
  const query = document.getElementById('aiInput').value.trim();
  if (!query) {
    Swal.fire('Error', 'Please enter a query!', 'error');
    return;
  }
  
  // Close the modal
  const modal = document.getElementById('aiModal');
  modal.classList.remove('open');
  
  // Show loading indicator
  Swal.fire({
    title: 'Generating Code...',
    allowOutsideClick: false,
    didOpen: () => Swal.showLoading(),
  });
  
  try {
    // Call Gemini API
    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Goog-Api-Key': 'AIzaSyCAIKTJTyUxfWBVZU4SrhuqBQkVMMEq16E', // Replace with your Gemini API key
      },
      body: JSON.stringify({
        contents: [
          {
            parts: [
              {
                text: `${query} and write full html, css and javascript in a single html file`,
              },
            ],
          },
        ],
      }),
    });
  
    if (!response.ok) {
      const errorResponse = await response.json();
      console.error('API Error Response:', errorResponse);
      throw new Error(`API Error: ${response.statusText}`);
    }
  
    const data = await response.json();
    console.log('API Response:', data);
  
    // Extract the generated code from the response
    const aiResponse = data.candidates[0].content.parts[0].text;
  
    // Check if "Code generated by AI" file exists
    const aiFile = fileExplorer.files.find((file) => file.name === 'Code generated by AI');
  
    if (aiFile) {
      // If the file exists, overwrite its content
      aiFile.content = aiResponse; // Overwrite the content
      fileExplorer.switchFile(aiFile.id);
    } else {
      // If the file doesn't exist, create it
      fileExplorer.addFile('Code generated by AI', aiResponse);
    }
  
    // Update the editor with the AI response
    editor.setValue(fileExplorer.files.find((file) => file.name === 'Code generated by AI').content);
    editor.clearSelection();
  
    // Show success message
    Swal.fire('Success', 'Code generated and added to "Code generated by AI" file!', 'success');
  } catch (error) {
    console.error('Error:', error);
    Swal.fire('Error', 'Failed to generate code. Please try again.', 'error');
  }
  });
  
  // Handle Enter key in the AI input
  document.getElementById('aiInput').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    document.getElementById('aiSubmitButton').click();
  }
  });
 </script>
 <script>
  // Initialize EmailJS with your account ID
  emailjs.init('0H1VceszFW8eCpp6p'); // Replace with your EmailJS user ID
  
  // Report Error Modal Logic
  const reportModal = document.getElementById('reportModal');
  const reportErrorBtn = document.getElementById('reportErrorBtn');
  const modalClose = document.querySelector('.modal-close');
  
  // Open modal
  reportErrorBtn.addEventListener('click', () => {
    reportModal.style.display = 'block';
  });
  
  // Close modal
  modalClose.addEventListener('click', () => {
    reportModal.style.display = 'none';
  });
  
  // Handle form submission
  document.getElementById('submitReport').addEventListener('click', async () => {
    const name = document.getElementById('reportName').value;
    const email = document.getElementById('reportEmail').value;
    const message = document.getElementById('reportMessage').value;
  
    if (!name || !email || !message) {
      Swal.fire('Error', 'Please fill all fields', 'error');
      return;
    }
  
    try {
      // Send email using EmailJS
      await emailjs.send('service_by6inxa', 'template_s3flrbh', {
        from_name: name,
        from_email: email,
        message: message,
        to_email: 'anshukumar72210@gmail.com'
      });
  
      // Clear form and close modal
      document.getElementById('reportName').value = '';
      document.getElementById('reportEmail').value = '';
      document.getElementById('reportMessage').value = '';
      reportModal.style.display = 'none';
  
      Swal.fire('Success!', 'Your report has been submitted', 'success');
    } catch (error) {
      console.error('Failed to send report:', error);
      Swal.fire('Error', 'Failed to submit report', 'error');
    }
  });
  
  // Close modal when clicking outside
  window.addEventListener('click', (e) => {
    if (e.target === reportModal) {
      reportModal.style.display = 'none';
    }
  });
 </script>
</body>
</html>
