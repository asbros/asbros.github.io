<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shared Social Feed</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- SweetAlert CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
</head>
<body class="bg-light">
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <h1 class="text-center mb-4 text-primary">Shared Social Feed</h1>
                
                <!-- User Details Form -->
                <div id="userForm">
                    <div class="card">
                        <div class="card-body">
                            <h2 class="card-title text-center">Enter Your Details</h2>
                            <form id="detailsForm">
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="name" placeholder="Your Name" required>
                                </div>
                                <div class="mb-3">
                                    <input type="email" class="form-control" id="email" placeholder="Your Email" required>
                                </div>
                                <div class="mb-3">
                                    <textarea class="form-control" id="bio" placeholder="Your Bio" rows="3"></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Save Details</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Profile & Sharing Section (Hidden until details saved) -->
                <div id="shareSection" class="d-none">
                    <!-- Profile Card -->
                    <div id="profile" class="card mb-4">
                        <div class="card-body text-center">
                            <h2 class="card-title">Your Profile</h2>
                            <p class="card-text"><strong>Name:</strong> <span id="displayName"></span></p>
                            <p class="card-text"><strong>Email:</strong> <span id="displayEmail"></span></p>
                            <p class="card-text"><strong>Bio:</strong> <span id="displayBio"></span></p>
                        </div>
                    </div>

                    <!-- Share Form -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h2 class="card-title">Share Images/Videos</h2>
                            <form id="shareForm">
                                <div class="mb-3">
                                    <input type="file" class="form-control" id="mediaFile" accept="image/*,video/*" required>
                                </div>
                                <button type="submit" class="btn btn-success w-100">Share Media</button>
                            </form>
                        </div>
                    </div>

                    <!-- Shared Feed -->
                    <div id="feed" class="card">
                        <div class="card-body">
                            <h2 class="card-title">Shared Feed (Visible to All Users)</h2>
                            <!-- Media items will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SweetAlert JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // Load saved user details on page load
        window.onload = function() {
            const savedUser = JSON.parse(localStorage.getItem('userDetails'));
            if (savedUser) {
                showShareSection(savedUser);
            }
            // Ensure shared feed has dummy posts if empty (simulates other users)
            initializeSharedFeed();
        };

        // Initialize shared feed with dummy posts if empty
        function initializeSharedFeed() {
            let sharedFeed = JSON.parse(localStorage.getItem('sharedFeed') || '[]');
            if (sharedFeed.length === 0) {
                // Dummy posts from "other users" (using placeholder URLs for demo)
                const dummies = [
                    {
                        userName: 'Alice Johnson',
                        type: 'image',
                        data: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=300&fit=crop',
                        timestamp: new Date(Date.now() - 86400000).toISOString(), // Yesterday
                        name: 'Beautiful Sunset'
                    },
                    {
                        userName: 'Bob Smith',
                        type: 'video',
                        data: 'https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4', // Sample video
                        timestamp: new Date(Date.now() - 3600000).toISOString(), // 1 hour ago
                        name: 'Fun Dance Video'
                    },
                    {
                        userName: 'Carol Davis',
                        type: 'image',
                        data: 'https://images.unsplash.com/photo-1517486808906-6ca8b3f04846?w=400&h=300&fit=crop',
                        timestamp: new Date().toISOString(), // Just now
                        name: 'City Lights'
                    }
                ];
                sharedFeed = dummies;
                localStorage.setItem('sharedFeed', JSON.stringify(sharedFeed));
            }
            // If in share section, display it
            if (!document.getElementById('userForm').classList.contains('d-none')) {
                displayFeed(sharedFeed);
            }
        }

        // Handle user details form
        document.getElementById('detailsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const bio = document.getElementById('bio').value.trim();

            if (!name || !email) {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops!',
                    text: 'Name and Email are required.',
                });
                return;
            }

            const userDetails = { name, email, bio };
            localStorage.setItem('userDetails', JSON.stringify(userDetails));

            Swal.fire({
                icon: 'success',
                title: 'Details Saved!',
                text: `Welcome, ${name}! You can now share media.`,
                timer: 2000,
                showConfirmButton: false
            }).then(() => {
                showShareSection(userDetails);
            });
        });

        function showShareSection(user) {
            document.getElementById('userForm').classList.add('d-none');
            document.getElementById('shareSection').classList.remove('d-none');

            // Display profile
            document.getElementById('displayName').textContent = user.name;
            document.getElementById('displayEmail').textContent = user.email;
            document.getElementById('displayBio').textContent = user.bio || 'No bio yet.';

            // Load and display shared feed
            const sharedFeed = JSON.parse(localStorage.getItem('sharedFeed') || '[]');
            displayFeed(sharedFeed);
        }

        // Handle media sharing
        document.getElementById('shareForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const fileInput = document.getElementById('mediaFile');
            const file = fileInput.files[0];

            if (!file) {
                Swal.fire({
                    icon: 'error',
                    title: 'No File!',
                    text: 'Please select an image or video.',
                });
                return;
            }

            // Warn about large files (localStorage limit)
            if (file.size > 5 * 1024 * 1024) { // 5MB
                Swal.fire({
                    icon: 'warning',
                    title: 'Large File!',
                    text: 'File is large (>5MB). It may not save properly in local storage.',
                });
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const savedUser = JSON.parse(localStorage.getItem('userDetails'));
                const mediaData = {
                    userName: savedUser.name,
                    type: file.type.startsWith('image') ? 'image' : 'video',
                    data: e.target.result, // Base64 for user uploads
                    timestamp: new Date().toISOString(),
                    name: file.name
                };

                // Add to shared feed
                let sharedFeed = JSON.parse(localStorage.getItem('sharedFeed') || '[]');
                sharedFeed.unshift(mediaData); // Add to top
                localStorage.setItem('sharedFeed', JSON.stringify(sharedFeed));

                // Refresh feed display
                displayFeed(sharedFeed);

                // Reset form
                fileInput.value = '';

                Swal.fire({
                    icon: 'success',
                    title: 'Shared!',
                    text: `Your ${mediaData.type} is now visible to all users!`,
                    timer: 2000,
                    showConfirmButton: false
                });
            };
            reader.onerror = function() {
                Swal.fire({
                    icon: 'error',
                    title: 'Upload Failed!',
                    text: 'Could not read the file. Try again.',
                });
            };
            reader.readAsDataURL(file);
        });

        function displayFeed(feed) {
            const feedBody = document.querySelector('#feed .card-body');
            feedBody.innerHTML = '<h2 class="card-title">Shared Feed (Visible to All Users)</h2><div id="feedItems"></div>';
            const feedItems = document.getElementById('feedItems');

            if (feed.length === 0) {
                feedItems.innerHTML = '<p class="text-muted text-center">No posts yet. Be the first to share!</p>';
                return;
            }

            feed.forEach(item => {
                const mediaItem = document.createElement('div');
                mediaItem.className = 'card mb-3';
                const mediaHtml = item.type === 'image' 
                    ? `<img src="${item.data}" class="card-img-top" alt="${item.name}" style="height: 200px; object-fit: cover;">`
                    : `<video src="${item.data}" class="card-img-top" controls style="height: 200px; object-fit: cover;"></video>`;
                
                mediaItem.innerHTML = `
                    <div class="card-body">
                        <h5 class="card-title">${item.name}</h5>
                        <p class="card-text"><strong>Posted by:</strong> ${item.userName}</p>
                        <p class="card-text"><small class="text-muted">${new Date(item.timestamp).toLocaleString()}</small></p>
                        ${mediaHtml}
                    </div>
                `;
                feedItems.appendChild(mediaItem);
            });
        }
    </script>
</body>
</html>
